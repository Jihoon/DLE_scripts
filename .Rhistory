GetSummaryForPlot <- function(eHH, fd_HH, cty, idx_remove=0) {
scaler <- eval(parse(text=paste0("scaler_",cty)))
HH_region <- eval(parse(text=paste0(cty, "_HH_region")))
eHH <- eHH %>%
mutate(totexpense2007MER = colSums(fd_HH) / scaler,
expense2007MER = colSums(fd_HH[setdiff(ICP_all_idx,idx_remove),]) / scaler,
pri_e_avg = rowMeans(select(eHH, V1:V500), na.rm = TRUE) * hh_size,
intensity = pri_e_avg / expense2007MER * 1000)  # In MJ/USD (2007 MER)
HH_sum <- eHH %>% select(hhid, weight:intensity) %>%
left_join(HH_region %>% select(hhid, region, urban), by="hhid")
return(HH_sum)
}
str(IND_HH_sum_2011_nosolid)
IND_HH_sum_2011
str(IND_HH_sum_2011)
IND_HH_sum_2011 <- GetSummaryForPlot(eHH_IND_2011, IND_FD_HH_adj_2011, "IND", 0)
IND_HH_sum_2004 <- GetSummaryForPlot(eHH_IND_2004, IND_FD_HH_adj_2004, "IND2", 0)
debug(GetSummaryForPlot)
IND_HH_sum_2011 <- GetSummaryForPlot(eHH_IND_2011, IND_FD_HH_adj_2011, "IND", 0)
str(eHH[,500:512])
IND_HH_sum_2011_nosolid <- GetSummaryForPlot(eHH_IND_2011_nosolid, IND_FD_HH_adj_2011, "IND", idx_cookingfuel)
str(eHH[,500:512])
idx_solid_fuel
idx_cookingfuel <-  c(153, 157, 162)  #c(157,162) #c(153, 157,161,162)   #
GetSummaryForPlot <- function(eHH, fd_HH, cty, idx_remove=0) {
scaler <- eval(parse(text=paste0("scaler_",cty)))
HH_region <- eval(parse(text=paste0(cty, "_HH_region")))
eHH <- eHH %>%
mutate(totexpense2007MER = colSums(fd_HH) / scaler)
eHH <- eHH %>%
mutate(expense2007MER = colSums(fd_HH[setdiff(ICP_all_idx,idx_remove),]) / scaler,
pri_e_avg = rowMeans(select(eHH, V1:V500), na.rm = TRUE) * hh_size,
intensity = pri_e_avg / expense2007MER * 1000)  # In MJ/USD (2007 MER)
HH_sum <- eHH %>% select(hhid, weight:intensity) %>%
left_join(HH_region %>% select(hhid, region, urban), by="hhid")
return(HH_sum)
}
IND_HH_sum_2011 <- GetSummaryForPlot(eHH_IND_2011, IND_FD_HH_adj_2011, "IND", 0)
GetSummaryForPlot <- function(eHH, fd_HH, cty, idx_remove=0) {
scaler <- eval(parse(text=paste0("scaler_",cty)))
HH_region <- eval(parse(text=paste0(cty, "_HH_region")))
eHH <- eHH %>%
mutate(expense2007MER = colSums(fd_HH[setdiff(ICP_all_idx,idx_remove),]) / scaler,
pri_e_avg = rowMeans(select(eHH, V1:V500), na.rm = TRUE) * hh_size,
intensity = pri_e_avg / expense2007MER * 1000)  # In MJ/USD (2007 MER)
eHH <- eHH %>%
mutate(totexpense2007MER = colSums(fd_HH) / scaler)
HH_sum <- eHH %>% select(hhid, weight:totexpense2007MER) %>%
left_join(HH_region %>% select(hhid, region, urban), by="hhid")
return(HH_sum)
}
IND_HH_sum_2011 <- GetSummaryForPlot(eHH_IND_2011, IND_FD_HH_adj_2011, "IND", 0)
IND_HH_sum_2011_nosolid <- GetSummaryForPlot(eHH_IND_2011_nosolid, IND_FD_HH_adj_2011, "IND", idx_cookingfuel)
IND_HH_sum_2011 <- GetSummaryForPlot(eHH_IND_2011, IND_FD_HH_adj_2011, "IND", 0)
IND_HH_sum_2004 <- GetSummaryForPlot(eHH_IND_2004, IND_FD_HH_adj_2004, "IND2", 0)
IND_HH_sum_2011_nosolid <- GetSummaryForPlot(eHH_IND_2011_nosolid, IND_FD_HH_adj_2011, "IND", idx_cookingfuel)
IND_HH_sum_2004_nosolid <- GetSummaryForPlot(eHH_IND_2004_nosolid, IND_FD_HH_adj_2004, "IND2", idx_cookingfuel)
max.int <- 250
max.exp <- 30000
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2011 %>% filter(urban==0), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2011 [USD 2007MER] (Rural India)", ylab="MJ/USD", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=eHH_IND_2011_nosolid %>% filter(urban==0), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2011 [USD 2007MER] (Rural India)", ylab="MJ/USD w/o solid fuel", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2011 %>% filter(urban==1), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2011  [USD 2007MER] (Urban India)", ylab="MJ/USD", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=eHH_IND_2011_nosolid %>% filter(urban==1), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2011 [USD 2007MER] (Urban India)", ylab="MJ/USD w/o solid fuel", size=I(0.15)) +
stat_smooth()
View(IND_HH_sum_2011_nosolid)
str(eHH_IND_2011_nosolid)
max.int <- 250
max.exp <- 30000
# 2011
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2011 %>% filter(urban==0), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2011 [USD 2007MER] (Rural India)", ylab="MJ/USD", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2011_nosolid %>% filter(urban==0), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2011 [USD 2007MER] (Rural India)", ylab="MJ/USD w/o solid fuel & LPG", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2011 %>% filter(urban==1), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2011 [USD 2007MER] (Urban India)", ylab="MJ/USD", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2011_nosolid %>% filter(urban==1), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2011 [USD 2007MER] (Urban India)", ylab="MJ/USD w/o solid fuel & LPG", size=I(0.15)) +
stat_smooth()
#2004
#2004
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2004 %>% filter(urban==0), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2004 [USD 2007MER] (Rural India)", ylab="MJ/USD", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2004_nosolid %>% filter(urban==0), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2004 [USD 2007MER] (Rural India)", ylab="MJ/USD w/o solid fuel & LPG", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2004 %>% filter(urban==1), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2004 [USD 2007MER] (Urban India)", ylab="MJ/USD", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2004_nosolid %>% filter(urban==1), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2004 [USD 2007MER] (Urban India)", ylab="MJ/USD w/o solid fuel & LPG", size=I(0.15)) +
stat_smooth()
summary(IND2_HH$expenditure,IND_HH$expenditure)
summary(IND2_HH$expenditure)
summary(IND_HH$expenditure)
haed(IND_HH_sum_2011 %>% select(totexpense2007MER, expenditure))
head(IND_HH_sum_2011 %>% select(totexpense2007MER, expenditure))
head(IND_HH_sum_2004 %>% select(totexpense2007MER, expenditure))
dim(IND_FD_HH_adj_2011)
(IND_FD_HH_adj_2011)[1:10,101540:101542]
dim(eHH_IND_2011_nosolid)
head(IND_HH$expenditure)
scaler_IND
colSums(IND_FD_HH_adj_2011)
colSums(IND_FD_HH_adj_2011)[1:10]
colSums(IND_FD_HH_adj_2004)[1:10]
colSums(IND_FD_HH_adj_2007)[1:10]
colSums(IND_FD_ICP_HH_adj)[1:10]
IND2_HH$expenditure[!:10]
IND2_HH$expenditure[1:10]
IND2_HH$hhid[1:10]
dim(IND2_FD_ICP_AllHH)
colSums(IND2_FD_ICP_AllHH)
colSums(IND2_FD_ICP_AllHH)[1:10]
IND2_HH$expenditure[1:10]
colSums(IND2_FD_ALL)[1:10]
dim(IND2_FD_ALL)
colSums(IND2_FD_ALL)[3:10]
str(IND2_FD_ALL[,3:10])
str(IND2_FD_ALL[,3:10, with=FALSE])
(IND2_FD_ALL[1:10,1:10, with=FALSE])
IND2_FD_ALL[,sum(3:4)]
IND2_FD_ALL[,sum(H22000111, H22000112, H22000113)]
IND2_FD_ALL[,sum(H22000111), sum(H22000112), sum)]
IND2_FD_ALL[,sum(H22000111), sum(H22000112), sum(H22000113))]
IND2_FD_ALL[,sum(H22000111), sum(H22000112), sum(H22000113)]
IND2_FD_ALL[,.(sum(H22000111), sum(H22000112), sum(H22000113))]
IND2_HH$expenditure[1:10]
IND2_HH$consumption[1:10]
IND2_HH$hhid[1:10]
IND2_FD_ICP_AllHH <- crossprod(CES_ICP_IND, as.matrix(IND2_FD_ALL[1:(dim(IND2_FD_ALL)[1]-n_CES_fuel),-c(1,2), with=FALSE])) %>%
rbind(as.matrix(IND2_FD_ALL[-(1:(dim(IND2_FD_ALL)[1]-n_CES_fuel)),-c(1,2) , with=FALSE]))
IND2_FD_AllHH_2004 <- IND2_FD_ICP_AllHH * PPP_IND / CPI_ratio_IND / EXR_IND  # to USD 2007 (MER)
dim(IND2_in_IND1)
colSums(IND2_in_IND1)[1:10]
colSums(IND2_FD_ALL)[1:10]
colSums(IND_FD_ALL)[1:10]
IND_HH$expenditure[1:10]
colSums(IND_FD_ALL)[3:10]
colSums(IND_FD_ALL[,3:10, with=FALSE])
IND_HH$consumption[1:10]
load(file="H:/MyDocuments/IO work/DLE_scripts/Saved tables/IND2_AllHHConsump.Rda")
colSums(IND_FD_ALL[,3:10, with=FALSE])
load( file="H:/MyDocuments/IO work/DLE_scripts/Saved tables/IND_AllHHConsump.Rda")
colSums(IND_FD_ALL[,3:10, with=FALSE])
IND_HH$expenditure[1:10]
colSums(IND_FD_ALL[,13:10, with=FALSE])
colSums(IND_FD_ALL[,1:10, with=FALSE])
colSums(IND_FD_ALL[,2:10, with=FALSE])
IND_HH$expenditure[1:10]
IND_HH$consumption[1:10]
IND_HH$hhid[1:10]
colSums(IND_FD_ICP_AllHH[,3:10, with=FALSE])
colSums(IND_FD_ICP_AllHH[,3:10])
colSums(IND2_FD_ICP_AllHH[,1:10])
colSums(IND2_FD_ALL[,2:10, with=FALSE])
PPP_IND / CPI_ratio_IND / EXR_IND
colSums(IND_FD_AllHH_2011[,2:10])
IND2_FD_AllHH_2004 <- IND2_FD_ICP_AllHH * PPP_IND / CPI_ratio_IND / EXR_IND  # to USD 2007 (MER)
colSums(IND_FD_AllHH_2011[,2:10])
colSums(IND_FD_HH_adj_2011[,2:10])
colSums(IND_FD_AllHH_2004[,2:10])
colSums(IND2_FD_AllHH_2004[,2:10])
colSums(IND_FD_HH_adj_2004[,2:10])
IND2_con_grwth
IND_con_grwth
IND_FD_HH_adj_2004 <- IND2_FD_AllHH_2004 * (chng_pct_IND + 1)
idx_inf <- which(is.infinite(chng_pct_IND))  # Identify rows with Inf adjustments
r_HH <- colSums(IND2_FD_AllHH_2004)/sum(IND2_FD_AllHH_2004)  # ratio of hh total to (unweighted) total
colSums(IND_FD_HH_adj_2004[,2:10])
colSums(IND_FD_HH_adj_2004[,2:10], rm.na=T)
colSums(IND_FD_HH_adj_2004[,2:10], na.rm=T)
colSums(IND2_FD_AllHH_2004[,2:10])
r_HH[1:10]
idx_inf
chng_pct_IND
IND_FD_adj[idx_inf]
IND_FD_HH_adj_2004[idx_inf,]
idx_inf
IND_FD_HH_adj_2004 <- IND2_FD_AllHH_2004 * (chng_pct_IND + 1)
colSums(IND2_FD_AllHH_2004[,2:10])
colSums(IND_FD_HH_adj_2004[,2:10])
colSums(IND_FD_HH_adj_2004[,2:10], na.rm=T)
IND_FD_HH_adj_2011 <- IND_FD_AllHH_2011 * (chng_pct_IND + 1)
colSums(IND_FD_HH_adj_2011[,2:10], na.rm=T)
colSums(IND2_FD_AllHH_2011[,2:10])
colSums(IND_FD_AllHH_2011[,2:10])
IND_FD_HH_adj_2004 <- IND2_FD_AllHH_2004 * (chng_pct_IND + 1)
idx_inf <- which(is.infinite(chng_pct_IND))  # Identify rows with Inf adjustments
r_HH <- colSums(IND2_FD_AllHH_2004)/sum(IND2_FD_AllHH_2004)  # ratio of hh total to (unweighted) total
sum
(r_HH)
sum(r_HH)
IND_FD_HH_adj_2004 <- IND2_FD_AllHH_2004 * (chng_pct_IND + 1)
idx_inf <- which(is.infinite(chng_pct_IND))  # Identify rows with Inf adjustments
r_HH <- colSums(IND2_FD_AllHH_2004)/sum(IND2_FD_AllHH_2004)  # ratio of hh total to (unweighted) total
colSums(IND_FD_HH_adj_2004[,2:10])
colSums(IND_FD_HH_adj_2011[,2:10], na.rm=T)
colSums(IND_FD_HH_adj_2004[,2:10], na.rm=T)
IND_FD_HH_adj_2004[idx_inf,] <- t(sapply(IND_FD_adj[idx_inf] * 1e6, # M.USD to USD
function(x) x * r_HH / sum(r_HH * IND2_HH$weight))) * scaler_IND * IND2_con_grwth
colSums(IND_FD_HH_adj_2004[,2:10], na.rm=T)
colnames(IND_FD_HH_adj_2004) <- substring(colnames(IND_FD_HH_adj_2004), 2)
colSums(IND_FD_HH_adj_2004[,2:10], na.rm=T)
IND_FD_HH_adj_2004 <- IND2_FD_AllHH_2004 * (chng_pct_IND + 1)
idx_inf <- which(is.infinite(chng_pct_IND))  # Identify rows with Inf adjustments
r_HH <- colSums(IND2_FD_AllHH_2004)/sum(IND2_FD_AllHH_2004)  # ratio of hh total to (unweighted) total
IND_FD_HH_adj_2004[idx_inf,] <- t(sapply(IND_FD_adj[idx_inf] * 1e6, # M.USD to USD
function(x) x * r_HH / sum(r_HH * IND2_HH$weight))) * scaler_IND * IND2_con_grwth
colnames(IND_FD_HH_adj_2004) <- substring(colnames(IND_FD_HH_adj_2004), 2)
IND_FD_HH_adj_2011 <- IND_FD_AllHH_2011 * (chng_pct_IND + 1)
idx_inf <- which(is.infinite(chng_pct_IND))  # Identify rows with Inf adjustments
r_HH <- colSums(IND_FD_AllHH_2011)/sum(IND_FD_AllHH_2011)  # ratio of hh total to (unweighted) total
IND_FD_HH_adj_2011[idx_inf,] <- t(sapply(IND_FD_adj[idx_inf] * 1e6, # M.USD to USD
function(x) x * r_HH / sum(r_HH * IND_HH$weight))) * scaler_IND * IND_con_grwth
rm(r_HH)
gc()
colSums(IND_FD_HH_adj_2004[,2:10], na.rm=T)
colSums(IND_FD_HH_adj_2011[,2:10], na.rm=T)
colSums(IND_FD_HH_adj_2011[,1:10], na.rm=T)
colSums(IND_FD_HH_adj_2004[,1:10], na.rm=T)
list[eHH_IND_2011, eHH_sd_2011] <-  GetHHSectoralEnergyPerCap(1:164, 'IND', IND_FD_HH_adj_2011, IND_intensity)
list[eHH_IND_2004, eHH_sd_2004] <-  GetHHSectoralEnergyPerCap(1:164, 'IND2', IND_FD_HH_adj_2004, IND_intensity)
idx_cookingfuel <-  c(153, 157, 162)  #c(157,162) #c(153, 157,161,162)   #
list[eHH_IND_2011_nosolid, eHH_sd_2011_nosolid] <-  GetHHSectoralEnergyPerCap(setdiff(ICP_all_idx,idx_cookingfuel),
'IND', IND_FD_HH_adj_2011, IND_intensity)
list[eHH_IND_2004_nosolid, eHH_sd_2004_nosolid] <-  GetHHSectoralEnergyPerCap(setdiff(ICP_all_idx,idx_cookingfuel),
'IND2', IND_FD_HH_adj_2004, IND_intensity)
IND_HH_sum_2011_nosolid <- GetSummaryForPlot(eHH_IND_2011_nosolid, IND_FD_HH_adj_2011, "IND", idx_cookingfuel)
IND_HH_sum_2004_nosolid <- GetSummaryForPlot(eHH_IND_2004_nosolid, IND_FD_HH_adj_2004, "IND2", idx_cookingfuel)
#2004
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2004 %>% filter(urban==0), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2004 [USD 2007MER] (Rural India)", ylab="MJ/USD", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2004_nosolid %>% filter(urban==0), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2004 [USD 2007MER] (Rural India)", ylab="MJ/USD w/o solid fuel & LPG", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2004 %>% filter(urban==1), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2004 [USD 2007MER] (Urban India)", ylab="MJ/USD", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2004_nosolid %>% filter(urban==1), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2004 [USD 2007MER] (Urban India)", ylab="MJ/USD w/o solid fuel & LPG", size=I(0.15)) +
stat_smooth()
str(IND_HH_sum_2004)
str(IND_HH_sum_2004_nosolid)
colSums(IND_FD_HH_adj_2004)[1:10]
debug(GetSummaryForPlot)
IND_HH_sum_2004_nosolid <- GetSummaryForPlot(eHH_IND_2004_nosolid, IND_FD_HH_adj_2004, "IND2", idx_cookingfuel)
eHH[1:10, 1:10]
eHH[1:10, 500:510]
colSums(fd_HH)[1:10]
colSums(fd_HH[setdiff(ICP_all_idx,idx_remove),])
colSums(fd_HH[setdiff(ICP_all_idx,idx_remove),])[1:10]
colSums(fd_HH)[1:10]
scaler
IND_HH_sum_2004 <- GetSummaryForPlot(eHH_IND_2004, IND_FD_HH_adj_2004, "IND2", 0)
eHH[1:10, 500:510]
eHH[1:10, 500:511]
IND_HH_sum_2004 <- GetSummaryForPlot(eHH_IND_2004, IND_FD_HH_adj_2004, "IND2", 0)
str(IND_HH_sum_2004)
IND_HH_sum_2004_nosolid <- GetSummaryForPlot(eHH_IND_2004_nosolid, IND_FD_HH_adj_2004, "IND2", idx_cookingfuel)
str(IND_HH_sum_2004_nosolid)
#2004
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2004 %>% filter(urban==0), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2004 [USD 2007MER] (Rural India)", ylab="MJ/USD", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2004_nosolid %>% filter(urban==0), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2004 [USD 2007MER] (Rural India)", ylab="MJ/USD w/o solid fuel & LPG", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2004 %>% filter(urban==1), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2004 [USD 2007MER] (Urban India)", ylab="MJ/USD", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2004_nosolid %>% filter(urban==1), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2004 [USD 2007MER] (Urban India)", ylab="MJ/USD w/o solid fuel & LPG", size=I(0.15)) +
stat_smooth()
IND_HH_sum_2011_nosolid <- GetSummaryForPlot(eHH_IND_2011_nosolid, IND_FD_HH_adj_2011, "IND", idx_cookingfuel)
undebug(GetSummaryForPlot)
IND_HH_sum_2004 <- GetSummaryForPlot(eHH_IND_2004, IND_FD_HH_adj_2004, "IND2", 0)
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2011 %>% filter(urban==0), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2011 [USD 2007MER] (Rural India)", ylab="MJ/USD", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2011_nosolid %>% filter(urban==0), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2011 [USD 2007MER] (Rural India)", ylab="MJ/USD w/o solid fuel & LPG", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2011 %>% filter(urban==1), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2011 [USD 2007MER] (Urban India)", ylab="MJ/USD", size=I(0.15)) +
stat_smooth()
qplot(totexpense2007MER, intensity, data=IND_HH_sum_2011_nosolid %>% filter(urban==1), geom="auto", xlim=c(0,max.exp), ylim=c(0,max.int),
xlab="Annual expenditure 2011 [USD 2007MER] (Urban India)", ylab="MJ/USD w/o solid fuel & LPG", size=I(0.15)) +
stat_smooth()
ICP_food_idx <- 1:45
ICP_hhold_idx <- c(56:84, 138:151)  # Household goods/services
ICP_svc_idx <- 85:137   # Health, Transport, Communication, Recreation
ICP_fuel_idx <-152:164
lsos(n=20)
ICP_food_idx <- 1:45
ICP_hhold_idx <- c(56:84, 138:151)  # Household goods/services
ICP_svc_idx <- 85:137   # Health, Transport, Communication, Recreation
ICP_fuel_idx <-152:164
list[eHH_IND_food_2011, eHH_sd_2011] <-  GetHHSectoralEnergyPerCap(ICP_food_idx, 'IND', IND_FD_HH_adj_2011, IND_intensity)
list[eHH_IND_hhold_2011, eHH_sd_2011] <-  GetHHSectoralEnergyPerCap(ICP_hhold_idx, 'IND', IND_FD_HH_adj_2011, IND_intensity)
list[eHH_IND_svc_2011, eHH_sd_2011] <-  GetHHSectoralEnergyPerCap(ICP_svc_idx, 'IND', IND_FD_HH_adj_2011, IND_intensity)
list[eHH_IND_fuel_2011, eHH_sd_2011] <-  GetHHSectoralEnergyPerCap(ICP_fuel_idx, 'IND', IND_FD_HH_adj_2011, IND_intensity)
IND_HH_food_2011 <- GetSummaryForPlot(eHH_IND_food_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_food_idx))
IND_HH_hhold_2011 <- GetSummaryForPlot(eHH_IND_hhold_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_hhold_idx))
IND_HH_svc_2011 <- GetSummaryForPlot(eHH_IND_svc_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_svc_idx))
IND_HH_fuel_2011 <- GetSummaryForPlot(eHH_IND_fuel_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_fuel_idx))
class(IND_HH_food_2011)
str(IND_HH_food_2011)
str(IND_HH_svc_2011)
IND_HH_food_2011 <- GetSummaryForPlot(eHH_IND_food_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_food_idx)) %>%
rename(En_food=pri_e_avg, I_food=intensity, Ex_food=expense2007MER)
IND_HH_hhold_2011 <- GetSummaryForPlot(eHH_IND_hhold_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_hhold_idx)) %>%
select(hhid, En_hhold=pri_e_avg, I_hhold=intensity, Ex_hhold=expense2007MER)
IND_HH_svc_2011 <- GetSummaryForPlot(eHH_IND_svc_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_svc_idx)) %>%
select(hhid, En_svc=pri_e_avg, I_svc=intensity, Ex_svc=expense2007MER)
IND_HH_fuel_2011 <- GetSummaryForPlot(eHH_IND_fuel_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_fuel_idx)) %>%
select(hhid, En_fuel=pri_e_avg, I_fuel=intensity, Ex_fuel=expense2007MER)
str(IND_HH_fuel_2011)
IND_HH_sum_sector <- IND_HH_food_2011 %>% left_join(IND_HH_hhold_2011) %>% left_join(IND_HH_svc_2011) %>% left_join(IND_HH_fuel_2011)
head(IND_HH_sum_sector)
head(IND_HH_sum_2004)
IND_HH_sum_sector_2011 <- IND_HH_food_2011 %>% left_join(IND_HH_hhold_2011) %>%
left_join(IND_HH_svc_2011) %>% left_join(IND_HH_fuel_2011) %>%
mutate(totPriEnergy = En_food+En_hhold+En_svc+En_fuel)
rm(IND_HH_sum_sector)
gc()
head(IND_HH_sum_sector_2011)
head(IND_HH_sum_2011)
ICP_oth_idx <- 46:55
IND_HH_oth_2011 <- GetSummaryForPlot(eHH_IND_oth_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_oth_idx)) %>%
select(hhid, En_oth=pri_e_avg, I_oth=intensity, Ex_oth=expense2007MER)
list[eHH_IND_oth_2011, eHH_sd_2011] <-  GetHHSectoralEnergyPerCap(ICP_oth_idx, 'IND', IND_FD_HH_adj_2011, IND_intensity)
IND_HH_oth_2011 <- GetSummaryForPlot(eHH_IND_oth_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_oth_idx)) %>%
select(hhid, En_oth=pri_e_avg, I_oth=intensity, Ex_oth=expense2007MER)
IND_HH_sum_sector_2011 <- IND_HH_food_2011 %>% left_join(IND_HH_hhold_2011) %>%
left_join(IND_HH_svc_2011) %>% left_join(IND_HH_fuel_2011) %>% left_join(IND_HH_oth_2011) %>%
mutate(totPriEnergy = En_food+En_hhold+En_svc+En_fuel)
head(IND_HH_sum_2011)
head(IND_HH_sum_sector_2011)
IND_HH_sum_sector_2011 <- IND_HH_food_2011 %>% left_join(IND_HH_hhold_2011) %>%
left_join(IND_HH_svc_2011) %>% left_join(IND_HH_fuel_2011) %>% left_join(IND_HH_oth_2011) %>%
mutate(totPriEnergy = En_food+En_hhold+En_svc+En_fuel+En_oth)
head(IND_HH_sum_sector_2011)
head(IND_HH_sum_2011)
?summarize_each
?summarize_at
IND_HH_sum_sector_2011 <- IND_HH_food_2011 %>% left_join(IND_HH_hhold_2011) %>%
left_join(IND_HH_svc_2011) %>% left_join(IND_HH_fuel_2011) %>% left_join(IND_HH_oth_2011) %>%
mutate(En_pri.tot = En_food+En_hhold+En_svc+En_fuel+En_oth)
?starts_with
a <- IND_HH_sum_sector_2011 %>% group_by(decile) %>%
summarise_at(vars(starts_with("En_"), sum)
)
a <- IND_HH_sum_sector_2011 %>% group_by(decile) %>%
summarise_at(vars(starts_with("En_")), sum)
a
a <- IND_HH_sum_sector_2011 %>% group_by(decile) %>%
summarise_at(vars(starts_with("En_")), sum) %>%
mutate_at(2:6, ./En_pri.tot)
a <- IND_HH_sum_sector_2011 %>% group_by(decile) %>%
summarise_at(vars(starts_with("En_")), sum) %>%
mutate_at(2:6, funs("pct" = ./En_pri.tot))
a
#2004
list[eHH_IND_food_2004, eHH_sd_2004] <-  GetHHSectoralEnergyPerCap(ICP_food_idx, 'IND', IND_FD_HH_adj_2004, IND_intensity)
list[eHH_IND_hhold_2004, eHH_sd_2004] <-  GetHHSectoralEnergyPerCap(ICP_hhold_idx, 'IND', IND_FD_HH_adj_2004, IND_intensity)
list[eHH_IND_svc_2004, eHH_sd_2004] <-  GetHHSectoralEnergyPerCap(ICP_svc_idx, 'IND', IND_FD_HH_adj_2004, IND_intensity)
#2004
list[eHH_IND_food_2004, eHH_sd_2004] <-  GetHHSectoralEnergyPerCap(ICP_food_idx, 'IND2', IND_FD_HH_adj_2004, IND_intensity)
list[eHH_IND_hhold_2004, eHH_sd_2004] <-  GetHHSectoralEnergyPerCap(ICP_hhold_idx, 'IND2', IND_FD_HH_adj_2004, IND_intensity)
list[eHH_IND_svc_2004, eHH_sd_2004] <-  GetHHSectoralEnergyPerCap(ICP_svc_idx, 'IND2', IND_FD_HH_adj_2004, IND_intensity)
list[eHH_IND_fuel_2004, eHH_sd_2004] <-  GetHHSectoralEnergyPerCap(ICP_fuel_idx, 'IND2', IND_FD_HH_adj_2004, IND_intensity)
list[eHH_IND_oth_2004, eHH_sd_2004] <-  GetHHSectoralEnergyPerCap(ICP_oth_idx, 'IND2', IND_FD_HH_adj_2004, IND_intensity)
IND_HH_food_2004 <- GetSummaryForPlot(eHH_IND_food_2004, IND_FD_HH_adj_2004, "IND2", setdiff(ICP_all_idx,ICP_food_idx)) %>%
rename(En_food=pri_e_avg, I_food=intensity, Ex_food=expense2007MER)
IND_HH_hhold_2004 <- GetSummaryForPlot(eHH_IND_hhold_2004, IND_FD_HH_adj_2004, "IND2", setdiff(ICP_all_idx,ICP_hhold_idx)) %>%
select(hhid, En_hhold=pri_e_avg, I_hhold=intensity, Ex_hhold=expense2007MER)
IND_HH_svc_2004 <- GetSummaryForPlot(eHH_IND_svc_2004, IND_FD_HH_adj_2004, "IND2", setdiff(ICP_all_idx,ICP_svc_idx)) %>%
select(hhid, En_svc=pri_e_avg, I_svc=intensity, Ex_svc=expense2007MER)
IND_HH_fuel_2004 <- GetSummaryForPlot(eHH_IND_fuel_2004, IND_FD_HH_adj_2004, "IND2", setdiff(ICP_all_idx,ICP_fuel_idx)) %>%
select(hhid, En_fuel=pri_e_avg, I_fuel=intensity, Ex_fuel=expense2007MER)
IND_HH_oth_2004 <- GetSummaryForPlot(eHH_IND_oth_2004, IND_FD_HH_adj_2004, "IND2", setdiff(ICP_all_idx,ICP_oth_idx)) %>%
select(hhid, En_oth=pri_e_avg, I_oth=intensity, Ex_oth=expense2007MER)
IND_HH_sum_sector_2004 <- IND_HH_food_2004 %>% left_join(IND_HH_hhold_2004) %>%
left_join(IND_HH_svc_2004) %>% left_join(IND_HH_fuel_2004) %>% left_join(IND_HH_oth_2004) %>%
mutate(En_pri.tot = En_food+En_hhold+En_svc+En_fuel+En_oth)
IND_ene_2004 <- IND_HH_sum_sector_2004 %>% group_by(decile) %>%
summarise_at(vars(starts_with("En_")), sum) %>%
mutate_at(2:6, funs("pct" = ./En_pri.tot))
rm(eHH_IND_food_2011, eHH_IND_hhold_2011, eHH_IND_svc_2011, eHH_IND_fuel_2011,
eHH_IND_food_2004, eHH_IND_hhold_2004, eHH_IND_svc_2004, eHH_IND_fuel_2004); gc()
IND_ene_2004
IND_ene_2011
a
write.table(IND_ene_2004, "clipboard", sep="\t", row.names = FALSE, col.names = TRUE)
write.table(a, "clipboard", sep="\t", row.names = FALSE, col.names = TRUE)
ICP_nosolid <- setdiff(152:164, c(153, 157, 162))
ICP_nosolid
list[eHH_IND_nosolid_2011, eHH_sd_2011] <-  GetHHSectoralEnergyPerCap(ICP_nosolid, 'IND', IND_FD_HH_adj_2011, IND_intensity)
list[eHH_IND_food_2011, eHH_sd_2011] <-  GetHHSectoralEnergyPerCap(ICP_food_idx, 'IND', IND_FD_HH_adj_2011, IND_intensity)
list[eHH_IND_hhold_2011, eHH_sd_2011] <-  GetHHSectoralEnergyPerCap(ICP_hhold_idx, 'IND', IND_FD_HH_adj_2011, IND_intensity)
list[eHH_IND_svc_2011, eHH_sd_2011] <-  GetHHSectoralEnergyPerCap(ICP_svc_idx, 'IND', IND_FD_HH_adj_2011, IND_intensity)
list[eHH_IND_fuel_2011, eHH_sd_2011] <-  GetHHSectoralEnergyPerCap(ICP_fuel_idx, 'IND', IND_FD_HH_adj_2011, IND_intensity)
list[eHH_IND_nosolid_2011, eHH_sd_2011] <-  GetHHSectoralEnergyPerCap(ICP_nosolid, 'IND', IND_FD_HH_adj_2011, IND_intensity)
list[eHH_IND_oth_2011, eHH_sd_2011] <-  GetHHSectoralEnergyPerCap(ICP_oth_idx, 'IND', IND_FD_HH_adj_2011, IND_intensity)
IND_HH_food_2011 <- GetSummaryForPlot(eHH_IND_food_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_food_idx)) %>%
rename(En_food=pri_e_avg, I_food=intensity, Ex_food=expense2007MER)
IND_HH_hhold_2011 <- GetSummaryForPlot(eHH_IND_hhold_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_hhold_idx)) %>%
select(hhid, En_hhold=pri_e_avg, I_hhold=intensity, Ex_hhold=expense2007MER)
IND_HH_svc_2011 <- GetSummaryForPlot(eHH_IND_svc_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_svc_idx)) %>%
select(hhid, En_svc=pri_e_avg, I_svc=intensity, Ex_svc=expense2007MER)
IND_HH_fuel_2011 <- GetSummaryForPlot(eHH_IND_fuel_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_fuel_idx)) %>%
select(hhid, En_fuel=pri_e_avg, I_fuel=intensity, Ex_fuel=expense2007MER)
IND_HH_oth_2011 <- GetSummaryForPlot(eHH_IND_oth_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_oth_idx)) %>%
select(hhid, En_oth=pri_e_avg, I_oth=intensity, Ex_oth=expense2007MER)
IND_HH_nosolid_2011 <- GetSummaryForPlot(eHH_IND_nosolid_2011, IND_FD_HH_adj_2011, "IND", setdiff(ICP_all_idx,ICP_nosolid)) %>%
select(hhid, En_nosol=pri_e_avg, I_nosol=intensity, Ex_nosol=expense2007MER)
IND_HH_sum_sector_2011_nosolid <- IND_HH_food_2011 %>% left_join(IND_HH_hhold_2011) %>%
left_join(IND_HH_svc_2011) %>% left_join(IND_HH_nosolid_2011) %>% left_join(IND_HH_oth_2011) %>%
mutate(En_pri.tot = En_food+En_hhold+En_svc+En_nosol+En_oth)
IND_ene_2011_nosolid <- IND_HH_sum_sector_2011_nosolid %>% group_by(decile) %>%
summarise_at(vars(starts_with("En_")), sum) %>%
mutate_at(2:6, funs("pct" = ./En_pri.tot))
IND_ene_2011_nosolid
write.table(IND_ene_2011_nosolid, "clipboard", sep="\t", row.names = FALSE, col.names = TRUE)
lsos(n=10)
xlcFreeMemory()
lsos(n=20)
install.packages(“reshape2”)
install.packages("reshape2")
install.packages("reshape2")
install.packages("C:/Users/min/Downloads/gdxrrw_1.0.1.tar.gz", repos = NULL, type = "source")
n_CES_fuel
warnings()
DLE_fuel_types
DLE_fuelnames_std
str(IND_FD[-grep("taxes", IND_FD$item, ignore.case = TRUE), ])
IND_FD_code <- IND_FD[-grep("taxes", IND_FD$item, ignore.case = TRUE), ]
# Merge sector code info
IND_FD_code <- merge(IND_FD_code[1:(dim(IND_FD_code)[1]-n_CES_fuel),], IND_map %>% select(CODE, COICOP1, COICOP2, item=ITEM_DLE),
by="item", all.x = TRUE) %>% arrange(CODE) %>%
select(-(COICOP1:COICOP2)) %>%
rbind(IND_FD[-(1:(dim(IND_FD)[1]-n_CES_fuel)),]%>% mutate(CODE=999))
IND_FD_code[is.na(IND_FD_code)] <- 0
a<-IND_FD_code
IND_FD_code <- IND_FD[-grep("taxes", IND_FD$item, ignore.case = TRUE), ]
# Merge sector code info
IND_FD_code <- merge(IND_FD_code[1:(dim(IND_FD_code)[1]-n_CES_fuel),], IND_map %>% select(CODE, item=ITEM_DLE),
by="item", all.x = TRUE) %>% arrange(CODE) %>%
rbind(IND_FD[-(1:(dim(IND_FD)[1]-n_CES_fuel)),]%>% mutate(CODE=999))
IND_FD_code[is.na(IND_FD_code)] <- 0
all.equal(a, IND_FD_code)
missing_cat
View(IND_map)
IND2_FD_code %>% filter(is.na(CODE))
a<-IND2_FD[-grep("taxes", IND2_FD$item, ignore.case = TRUE), ]
a<-merge(a[1:(dim(a)[1]-n_CES_fuel),], IND_map %>% select(CODE, item=ITEM_DLE),
by="item", all.x = TRUE) %>% arrange(CODE) %>%
rbind(IND2_FD[-(1:(dim(IND2_FD)[1]-n_CES_fuel)),]%>% mutate(CODE=999))
a
a %>% filter(is.na(CODE))
missing_cat
missing_cat <- read.xlsx("H:/MyDocuments/IO work/Bridging/CES-COICOP/For IND2-IND1 matching.xlsx", 2) %>% select(item, CODE)
missing_cat
idx_nonfuel
idx_nonfuel <- 1:(dim(IND2_FD_ALL)[1]-n_CES_fuel)
idx_nonfuel
load(file="H:/MyDocuments/IO work/DLE_scripts/Saved tables/IND2_in_IND1.Rda")
dim(IND2_in_IND1)
xlcFreeMemory()
lsos(n=20)
gc()
setDT(IND2_in_IND1, key="CODE")
setDT(item_code, key="CODE")
IND2_in_IND1 <- IND2_in_IND1[item_code]   # merge data.tables (left join) - FASTER!
dim(IND2_in_IND1)
dim(IND2_FD_ALL_ICP)
dim(IND_FD_ALL_ICP)
IND_con_grwth
consumption_growth
chng_pct_IND
IND2_con_grwth
rm(r_HH)
gc()
lsos(n=20)
rm(eHH_IND_food_2011,eHH_IND_fuel_2011,eHH_IND_oth_2011,eHH_IND_svc_2011,eHH_IND_oth_2004)
gc()
lsos(n=20)
rm(eHH_IND_hhold_2011)
dim(eHH_IND_2011)
diki(IND_HH_sum_2011)
dim(IND_HH_sum_2011)
str(IND_HH_sum_2011)
?gini
??gini
gini(IND_HH_sum_2011$intensity, IND_HH_sum_2011$weight)
library("reldist", lib.loc="~/R/win-library/3.3")
gini(IND_HH_sum_2011$intensity, IND_HH_sum_2011$weight)
gini(IND_HH_sum_2004$intensity, IND_HH_sum_2004$weight)
gini(IND_HH_sum_2011_nosolid$intensity, IND_HH_sum_2011_nosolid$weight)
gini(IND_HH_sum_2004_nosolid$intensity, IND_HH_sum_2004_nosolid$weight)
