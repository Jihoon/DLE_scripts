# geom_point(aes(x=cum.gdp.SSP2-cum.gdp.now, y=cum.ene.SSP2-cum.ene.now, shape="SSP2"), color="green") +
# geom_text_repel(data=cum.tot %>% filter(gdp.SSP2>1200), aes(x=cum.gdp.SSP2-cum.gdp.now, y=cum.ene.SSP2-cum.ene.now, label=iso3c), size = 2.5, color="red") +
geom_line(aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now, color="SSP4 (g=0.45)"), size=lsize) +
geom_point(aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now, color="SSP4 (g=0.45)"), shape=24, color="deepskyblue", size=1) +
geom_point(data=cum.tot %>% filter(gdp.SSP4-gdp.pcap*pop/1e9>thres), aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now), fill="blue4", shape=24, size=3) +
geom_text(data=cum.tot %>% filter(gdp.SSP4-gdp.pcap*pop/1e9>thres), aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now, label=iso3c),
size = fsize, color="blue4", nudge_x=-xoffs, nudge_y=yoffs) +
# geom_line(aes(x=1:dim(a)[1], y=cum.ene.now, color="2013 (g=0.46)")) +
# geom_point(aes(x=1:dim(a)[1], y=cum.ene.now, shape="5")) +
labs(x="Total GDP diff between 2013 and 2050 (b$)", y=element_blank(),
title=expression(paste(alpha, "=", 0.7))) +
geom_line(aes(x=cum.gdp.SSP1-cum.gdp.now, y=sum(tot.ene.SSP1-tot.ene.now)/sum(gdp.SSP1-gdp.pcap*pop/1e9)*(cum.gdp.SSP1-cum.gdp.now)),
color="green4", linetype = "twodash") +
theme_bw() + ylim(c(0, 2.6e13)) +
scale_color_manual(name = "Scenario", values=cols) +
scale_fill_manual(name = "Scenario", values=cols)
elas.case <- "max"  # "min" #
elas.cty <- formatC(if(elas.case=="base") elas.base.cty else if(elas.case=="max") elas.max.cty else elas.min.cty,
digits = 2, format="f")
cum.tot <- CumulEnergyGDP(elas.case)
# show intensity.change
print(cum.tot %>% select(starts_with("intensity.")) %>% slice(n()) / 1e9)
g2 <- ggplot(cum.tot, aes(x=cum.gdp.SSP1-cum.gdp.now, y=cum.ene.SSP1-cum.ene.now)) + geom_line(aes(color="SSP1 (g=0.30)"), size=lsize) +
geom_point(aes(color="SSP1 (g=0.30)"), shape=25, color="violet", size=1) +
geom_point(data=cum.tot %>% filter(gdp.SSP1-gdp.pcap*pop/1e9>thres), fill="violetred", shape=25, size=3) +
geom_text(data=cum.tot %>% filter(gdp.SSP1-gdp.pcap*pop/1e9>thres), aes(label=iso3c), size = fsize, color="violetred",
nudge_x=xoffs, nudge_y=-yoffs) +
geom_line(aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now, color="SSP4 (g=0.45)"), size=lsize) +
geom_point(aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now, color="SSP4 (g=0.45)"), shape=24, color="deepskyblue", size=1) +
geom_point(data=cum.tot %>% filter(gdp.SSP4-gdp.pcap*pop/1e9>thres), aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now),
fill="blue4", shape=24, size=3) +
geom_text(data=cum.tot %>% filter(gdp.SSP4-gdp.pcap*pop/1e9>thres), aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now, label=iso3c),
size = fsize, color="blue4", nudge_x=-xoffs, nudge_y=yoffs) +
labs(x="Total GDP diff between 2013 and 2050 (b$)", y="Cumulative energy diff between 2013 & 2050 (kgoe)",
title=expression(paste(alpha, "=", 1.0))) +
geom_line(aes(x=cum.gdp.SSP1-cum.gdp.now, y=sum(tot.ene.SSP1-tot.ene.now)/sum(gdp.SSP1-gdp.pcap*pop/1e9)*(cum.gdp.SSP1-cum.gdp.now)),
color="green4", linetype = "twodash") +
theme_bw() + ylim(c(0, 2.6e13)) +
scale_color_manual(values=cols, guide="none") +
scale_fill_manual(values=cols, guide="none")
pdf(file = paste0(fig_path, "SSP1 vs SSP4.pdf"), width = 10, height = 4)
plot_grid(g2, g1, nrow=1, labels = c('(a)', '(b)'), rel_widths = c(1, 1.2))
dev.off()
dev.off()
pdf(file = paste0(fig_path, "SSP1 vs SSP4.pdf"), width = 10, height = 4)
plot_grid(g2, g1, nrow=1, labels = c('(a)', '(b)'), rel_widths = c(1, 1.2))
dev.off()
elas.case <- "min" #
elas.cty <- formatC(if(elas.case=="base") elas.base.cty else if(elas.case=="max") elas.max.cty else elas.min.cty,
digits = 2, format="f")
cum.tot <- CumulEnergyGDP(elas.case)
# show intensity.change
print(cum.tot %>% select(starts_with("intensity.")) %>% slice(n()) / 1e9)
thres <- 3000
xoffs <- 15000
yoffs <- 1e12
fsize <- 3
lsize <- 0.7
cols <- c("SSP1 (g=0.30)"="pink","SSP4 (g=0.45)"="skyblue1")
fills <- c("SSP1 (g=0.30)"="pink","SSP4 (g=0.45)"="skyblue1")
g1 <- ggplot(cum.tot, aes(x=cum.gdp.SSP1-cum.gdp.now, y=cum.ene.SSP1-cum.ene.now)) + geom_line(aes(color="SSP1 (g=0.30)"), size=lsize) +
geom_point(aes(color="SSP1 (g=0.30)"), shape=25, color="violet", size=1) +
geom_point(data=cum.tot %>% filter(gdp.SSP1-gdp.pcap*pop/1e9>thres), fill="violetred", shape=25, size=3) +
geom_text(data=cum.tot %>% filter(gdp.SSP1-gdp.pcap*pop/1e9>thres), aes(label=iso3c), size = fsize, color="violetred",
nudge_x=xoffs, nudge_y=-yoffs) +
# geom_line(aes(x=cum.gdp.SSP2-cum.gdp.now, y=cum.ene.SSP2-cum.ene.now, color="SSP2 (g=0.36)")) +
# geom_point(aes(x=cum.gdp.SSP2-cum.gdp.now, y=cum.ene.SSP2-cum.ene.now, shape="SSP2"), color="green") +
# geom_text_repel(data=cum.tot %>% filter(gdp.SSP2>1200), aes(x=cum.gdp.SSP2-cum.gdp.now, y=cum.ene.SSP2-cum.ene.now, label=iso3c), size = 2.5, color="red") +
geom_line(aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now, color="SSP4 (g=0.45)"), size=lsize) +
geom_point(aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now, color="SSP4 (g=0.45)"), shape=24, color="deepskyblue", size=1) +
geom_point(data=cum.tot %>% filter(gdp.SSP4-gdp.pcap*pop/1e9>thres), aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now), fill="blue4", shape=24, size=3) +
geom_text(data=cum.tot %>% filter(gdp.SSP4-gdp.pcap*pop/1e9>thres), aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now, label=iso3c),
size = fsize, color="blue4", nudge_x=-xoffs, nudge_y=yoffs) +
# geom_line(aes(x=1:dim(a)[1], y=cum.ene.now, color="2013 (g=0.46)")) +
# geom_point(aes(x=1:dim(a)[1], y=cum.ene.now, shape="5")) +
labs(x="Total GDP diff between 2013 and 2050 (b$)", y=element_blank(),
title=expression(paste(alpha, "=", 0.7))) +
geom_line(aes(x=cum.gdp.SSP1-cum.gdp.now, y=sum(tot.ene.SSP1-tot.ene.now)/sum(gdp.SSP1-gdp.pcap*pop/1e9)*(cum.gdp.SSP1-cum.gdp.now)),
color="green4", linetype = "twodash") +
theme_bw() + ylim(c(0, 2.6e13)) +
scale_color_manual(name = "Scenario", values=cols) +
scale_fill_manual(name = "Scenario", values=cols)
elas.case <- "max"  # "min" #
elas.cty <- formatC(if(elas.case=="base") elas.base.cty else if(elas.case=="max") elas.max.cty else elas.min.cty,
digits = 2, format="f")
cum.tot <- CumulEnergyGDP(elas.case)
# show intensity.change
print(cum.tot %>% select(starts_with("intensity.")) %>% slice(n()) / 1e9)
g2 <- ggplot(cum.tot, aes(x=cum.gdp.SSP1-cum.gdp.now, y=cum.ene.SSP1-cum.ene.now)) + geom_line(aes(color="SSP1 (g=0.30)"), size=lsize) +
geom_point(aes(color="SSP1 (g=0.30)"), shape=25, color="violet", size=1) +
geom_point(data=cum.tot %>% filter(gdp.SSP1-gdp.pcap*pop/1e9>thres), fill="violetred", shape=25, size=3) +
geom_text(data=cum.tot %>% filter(gdp.SSP1-gdp.pcap*pop/1e9>thres), aes(label=iso3c), size = fsize, color="violetred",
nudge_x=xoffs, nudge_y=-yoffs) +
geom_line(aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now, color="SSP4 (g=0.45)"), size=lsize) +
geom_point(aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now, color="SSP4 (g=0.45)"), shape=24, color="deepskyblue", size=1) +
geom_point(data=cum.tot %>% filter(gdp.SSP4-gdp.pcap*pop/1e9>thres), aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now),
fill="blue4", shape=24, size=3) +
geom_text(data=cum.tot %>% filter(gdp.SSP4-gdp.pcap*pop/1e9>thres), aes(x=cum.gdp.SSP4-cum.gdp.now, y=cum.ene.SSP4-cum.ene.now, label=iso3c),
size = fsize, color="blue4", nudge_x=-xoffs, nudge_y=yoffs) +
labs(x="Total GDP diff between 2013 and 2050 (b$)", y="Cumulative energy diff between 2013-2050 (kgoe)",
title=expression(paste(alpha, "=", 1.0))) +
geom_line(aes(x=cum.gdp.SSP1-cum.gdp.now, y=sum(tot.ene.SSP1-tot.ene.now)/sum(gdp.SSP1-gdp.pcap*pop/1e9)*(cum.gdp.SSP1-cum.gdp.now)),
color="green4", linetype = "twodash") +
theme_bw() + ylim(c(0, 2.6e13)) +
scale_color_manual(values=cols, guide="none") +
scale_fill_manual(values=cols, guide="none")
pdf(file = paste0(fig_path, "SSP1 vs SSP4.pdf"), width = 10, height = 4)
plot_grid(g2, g1, nrow=1, labels = c('(a)', '(b)'), rel_widths = c(1, 1.2))
dev.off()
pdf(file = paste0(fig_path, "SSP1 vs SSP4.pdf"), width = 10, height = 4)
plot_grid(g2, g1, nrow=1, labels = c('(a)', '(b)'), rel_widths = c(1, 1.3))
dev.off()
pdf(file = paste0(fig_path, "SSP1 vs SSP4.pdf"), width = 10, height = 4)
plot_grid(g2, g1, nrow=1, labels = c('(a)', '(b)'), rel_widths = c(1, 1.3))
dev.off()
pdf(file = paste0(fig_path, "Energy intensity in 2013.pdf"), width = 10, height = 6)
PlotIntensityVsGDPpcap("base")
dev.off()
pdf(file = paste0(fig_path, "Energy intensity in 2013.pdf"), width = 10, height = 6)
PlotIntensityVsGDPpcap("base")
dev.off()
head(BRA_hh_no_food)
dim(tot.expend.food)
length(tot.expend.food)
dim(exp.food.allHH)
head(exp.food.allHH)
exp.food.allHH[tot.expend.food==0] %>% group_by(decile) %>% summarise(pop=sum(weight*hh_size))
list[BRA2_FD_ALL, BRA2_HH] <- readFinalDemandfromDBAllHH('BRA2')
BRA2_FD_ALL <- data.table(BRA2_FD_ALL)
BRA2_HH <- data.table(BRA2_HH, key="hhid")
setorder(BRA2_HH, hhid)
BRA2_hh <- selectDBdata(ID, WEIGHT, INCOME, CONSUMPTION, EXPENDITURe, tables='BRA2_HH')
BRA2_fd <- selectDBdata(tables='BRA2_FOOD')
BRA2_fuel <- selectDBdata(tables='BRA2_FUEL')
BRA2_oth <- selectDBdata(tables='BRA2_OTHCON')
BRA2 <- BRA2_hh %>% left_join(BRA2_fd) %>% left_join(BRA2_fuel) %>% left_join(BRA2_oth)
BRA2_fd <- selectDBdata(tables='BRA2_FOOD') %>% select(-survey) %>% rename(item_food = item, val_food = val_tot, qty_food = qty_tot, unit_food = unit)
BRA2_fuel <- selectDBdata(tables='BRA2_FUEL') %>% select(-survey) %>% rename(item_fuel = fuel, val_fuel = val_tot, qty_fuel = qty_tot, unit_fuel = unit)
BRA2_oth <- selectDBdata(tables='BRA2_OTHCON') %>% select(-survey) %>% rename(item_oth = item, val_oth = val_tot)
BRA2 <- BRA2_hh %>% left_join(BRA2_fd) %>% left_join(BRA2_fuel) %>% left_join(BRA2_oth)
BRA2_fd <- selectDBdata(tables='BRA2_FOOD') %>% select(-survey) %>% rename(item_food = item, val_food = val_tot, qty_food = qty_tot, unit_food = unit) %>%
group_by(id) %>% summarise(sum(val_tot))
BRA2_fd <- selectDBdata(tables='BRA2_FOOD') %>% select(-survey) %>% rename(item_food = item, val_food = val_tot, qty_food = qty_tot, unit_food = unit) %>%
group_by(id) %>% summarise(sum(val_food))
View(BRA2_fd)
?sum
BRA2_fd <- selectDBdata(tables='BRA2_FOOD') %>% select(-survey) %>% rename(item_food = item, val_food = val_tot, qty_food = qty_tot, unit_food = unit) %>%
group_by(id) %>% summarise(sum(val_food, na.rm = TRUE), sum(qty_food, na.rm = TRUE))
View(BRA2_fd)
BRA2_fd <- selectDBdata(tables='BRA2_FOOD') %>% select(-survey) %>% rename(item_food = item, val_food = val_tot, qty_food = qty_tot, unit_food = unit) %>%
group_by(id) %>% summarise(val_food=sum(val_food, na.rm = TRUE), qty_food=sum(qty_food, na.rm = TRUE))
BRA2_fuel <- selectDBdata(tables='BRA2_FUEL') %>% select(-survey) %>% rename(item_fuel = fuel, val_fuel = val_tot, qty_fuel = qty_tot, unit_fuel = unit)%>%
group_by(id) %>% summarise(val_fuel=sum(val_fuel, na.rm = TRUE), qty_fuel=sum(qty_fuel, na.rm = TRUE))
BRA2_oth <- selectDBdata(tables='BRA2_OTHCON') %>% select(-survey) %>% rename(item_oth = item, val_oth = val_tot)%>%
group_by(id) %>% summarise(val_oth=sum(val_oth, na.rm = TRUE))
BRA2 <- BRA2_hh %>% left_join(BRA2_fd) %>% left_join(BRA2_fuel) %>% left_join(BRA2_oth)
View(BRA2)
BRA2 <- BRA2_hh %>% left_join(BRA2_fd) %>% left_join(BRA2_fuel) %>% left_join(BRA2_oth) %>% mutate(valsum=val_oth+val_food+val_fuel)
head(val_oth)
head(BRA2)
BRA2 <- BRA2_hh %>% left_join(BRA2_fd) %>% left_join(BRA2_fuel) %>% left_join(BRA2_oth) %>% mutate(valsum=val_oth+val_food+val_fuel) %>% arrange(val_food)
head(BRA2)
BRA2 %>%filter(val_food==NA)
?left_join
BRA1_hh <- selectDBdata(ID, WEIGHT, INCOME, CONSUMPTION, EXPENDITURe, tables='BRA1_HH')
BRA1_fd <- selectDBdata(tables='BRA1_FOOD') %>% select(-survey) %>% rename(item_food = item, val_food = val_tot, qty_food = qty_tot, unit_food = unit) %>%
group_by(id) %>% summarise(val_food=sum(val_food, na.rm = TRUE), qty_food=sum(qty_food, na.rm = TRUE))
BRA1_fuel <- selectDBdata(tables='BRA1_FUEL') %>% select(-survey) %>% rename(item_fuel = fuel, val_fuel = val_tot, qty_fuel = qty_tot, unit_fuel = unit)%>%
group_by(id) %>% summarise(val_fuel=sum(val_fuel, na.rm = TRUE), qty_fuel=sum(qty_fuel, na.rm = TRUE))
BRA1_oth <- selectDBdata(tables='BRA1_OTHCON') %>% select(-survey) %>% rename(item_oth = item, val_oth = val_tot)%>%
group_by(id) %>% summarise(val_oth=sum(val_oth, na.rm = TRUE))
BRA1 <- BRA1_hh %>% left_join(BRA1_fd) %>% left_join(BRA1_fuel) %>% left_join(BRA1_oth) %>% mutate(valsum=val_oth+val_food+val_fuel) %>% arrange(val_food)
BRA2 <- BRA2_hh %>% left_join(BRA2_fd)
BRA2 <- BRA2_hh %>% left_join(BRA2_fd) %>% left_join(BRA2_fuel) %>% left_join(BRA2_oth) %>% mutate(valsum=val_oth+val_food+val_fuel) %>% arrange(val_food)
BRA2 <- BRA2_hh %>% left_join(BRA2_fd) %>% left_join(BRA2_fuel) %>% left_join(BRA2_oth) %>% mutate(valsum=val_oth+val_food+val_fuel) %>%
arrange(val_food) %>% filter(is.na(val_food))
BRA1 <- BRA1_hh %>% left_join(BRA1_fd) %>% left_join(BRA1_fuel) %>% left_join(BRA1_oth) %>% mutate(valsum=val_oth+val_food+val_fuel) %>%
arrange(val_food) %>% filter(is.na(val_food))
hist(BRA2$income)
hist(BRA1$income)
IND1_hh <- selectDBdata(ID, WEIGHT, INCOME, CONSUMPTION, EXPENDITURE, tables='IND1_HH')
IND1_fd <- selectDBdata(tables='IND1_FOOD') %>% select(-survey) %>% rename(item_food = item, val_food = val_tot, qty_food = qty_tot, unit_food = unit) %>%
group_by(id) %>% summarise(val_food=sum(val_food, na.rm = TRUE), qty_food=sum(qty_food, na.rm = TRUE))
IND1_hh <- selectDBdata(ID, WEIGHT, CONSUMPTION, EXPENDITURE, tables='IND1_HH')
IND1_fd <- selectDBdata(tables='IND1_FOOD') %>% select(-survey) %>% rename(item_food = item, val_food = val_tot, qty_food = qty_tot, unit_food = unit) %>%
group_by(id) %>% summarise(val_food=sum(val_food, na.rm = TRUE), qty_food=sum(qty_food, na.rm = TRUE))
IND1_fuel <- selectDBdata(tables='IND1_FUEL') %>% select(-survey) %>% rename(item_fuel = fuel, val_fuel = val_tot, qty_fuel = qty_tot, unit_fuel = unit)%>%
group_by(id) %>% summarise(val_fuel=sum(val_fuel, na.rm = TRUE), qty_fuel=sum(qty_fuel, na.rm = TRUE))
IND1_oth <- selectDBdata(tables='IND1_OTHCON') %>% select(-survey) %>% rename(item_oth = item, val_oth = val_tot)%>%
group_by(id) %>% summarise(val_oth=sum(val_oth, na.rm = TRUE))
IND1 <- IND1_hh %>% left_join(IND1_fd) %>% left_join(IND1_fuel) %>% left_join(IND1_oth) %>% mutate(valsum=val_oth+val_food+val_fuel) %>%
arrange(val_food) %>% filter(is.na(val_food))
lsos(n=20)
gc()
xlcfr
xlcFreeMemory()
lsos(n=10)
install.packages("C:/Users/min/Downloads/ROracle_1.2-1.zip", repos = NULL, type = "win.binary")
library(ROracle)
lsos(n=10)
rm(IND_FD_ALL)
rm(food_items)
rm(price_plot)
rm(pr_plot)
rm(materials)
rm(rice_wheat)
gc()
xlcFreeMemory()
BRA1 <- BRA1_hh %>% left_join(BRA1_fd) %>% left_join(BRA1_fuel) %>% left_join(BRA1_oth) %>% mutate(valsum=val_oth+val_food+val_fuel) %>%
arrange(val_food)
BRA1_nf <- BRA1 %>% filter(is.na(val_food))
hist(BRA1$income, 1000)
hist(BRA1_nf$income, 1000)
?hist
hist(BRA1$income, 1000, xlim=c(0, 1e5))
hist(BRA1_nf$income, 1000, xlim=c(0, 1e5))
BRA2 <- BRA2_hh %>% left_join(BRA2_fd) %>% left_join(BRA2_fuel) %>% left_join(BRA2_oth) %>% mutate(valsum=val_oth+val_food+val_fuel) %>%
arrange(val_food)
BRA2_nf <- BRA2 %>% filter(is.na(val_food))
hist(BRA2$income, 1000, xlim=c(0, 1e5))
hist(BRA2_nf$income, 1000, xlim=c(0, 1e5))
hist(BRA2$income, 1000)
BRA1_nf
View(BRA1_nf)
?sum
BRA2 <- BRA2_hh %>% left_join(BRA2_fd) %>% left_join(BRA2_fuel) %>% left_join(BRA2_oth) %>% mutate(valsum=sum(val_oth, val_food, val_fuel, na.rm = TRUE)) %>%
arrange(val_food)
BRA2_nf <- BRA2 %>% filter(is.na(val_food))
BRA1 <- BRA1_hh %>% left_join(BRA1_fd) %>% left_join(BRA1_fuel) %>% left_join(BRA1_oth) %>% mutate(valsum=sum(val_oth, val_food, val_fuel, na.rm = TRUE)) %>%
arrange(val_food)
BRA1_nf <- BRA1 %>% filter(is.na(val_food))
?rowwise
BRA2 <- BRA2_hh %>% left_join(BRA2_fd) %>% left_join(BRA2_fuel) %>% left_join(BRA2_oth) %>% rowwise() %>% mutate(valsum=sum(val_oth, val_food, val_fuel, na.rm = TRUE)) %>%
arrange(val_food)
BRA2_nf <- BRA2 %>% filter(is.na(val_food))
BRA1 <- BRA1_hh %>% left_join(BRA1_fd) %>% left_join(BRA1_fuel) %>% left_join(BRA1_oth) %>% rowwise() %>% mutate(valsum=sum(val_oth, val_food, val_fuel, na.rm = TRUE)) %>%
arrange(val_food)
BRA1_nf <- BRA1 %>% filter(is.na(val_food))
hist(BRA1$income, 1000, xlim=c(0, 1e5))
BRA1_hh <- selectDBdata(tables='BRA1_HH')
describe(BRA1_hh)
library(Hmisc)
describe(BRA1_hh)
?describe
BRA1 <- BRA1_hh %>% left_join(BRA1_fd) %>% left_join(BRA1_fuel) %>% left_join(BRA1_oth) %>% rowwise() %>% mutate(valsum=sum(val_oth, val_food, val_fuel, na.rm = TRUE)) %>%
arrange(val_food)
BRA1_nf <- BRA1 %>% filter(is.na(val_food))
describe(BRA1_nf)
a <- describe(BRA1_nf)
b <- describe(BRA1_hh)
a <- describe(BRA1_nf[,-33:36])
a <- describe(BRA1_nf%>%select(-33:36)])
a <- describe(BRA1_nf%>%select(-33:36))
?select
a <- describe(BRA1_nf%>%select(-c(33:36)))
a
a <- describe(BRA1_nf%>%select(-c(33, 34, 35, 36)))
view(a)
View(a)
str(BRA1_nf)
dim(BRA1_nf)
a <- describe(BRA1_nf%>%select(-c(33:38)))
b <- describe(BRA1_hh)
a
b
a$wall_mat
b$wall_mat
b$dwell_type
a$dwell_type
a$dwell_status
b$dwell_status
b$region
a$region
a$race
b$race
b$hh_size
a$hh_size
a$minor
b$minor
b$male_adult
a$male_adult
a$male
b$male
b$income
a$income
EX_catnames
View(EX_catnames)
View(t(EX_catnames))
emissions <- read.table(paste(path_iot, "mrEmissions_version2.2.2.txt", sep=""), header=FALSE, sep="\t", dec=".",
skip=2, nrows=85, stringsAsFactors = FALSE)
emissions <- emissions %>% select(-V2, -V3) %>% filter(grepl('CH4|CO2|N2O', V1))
GHG_item <- emissions$V1
GHG_item
emissions_2.3 <- read.table(paste(path_iot, "mrEmissions_version2.3.0.txt", sep=""), header=FALSE, sep="\t", dec=".",
skip=2, nrows=85, stringsAsFactors = FALSE)
path_iot_2.3 <- 'C:/Users/min/SharePoint/DLE - Documents/IO/Data - EXIOBASE/extension2.3.0/'
emissions_2.3 <- read.table(paste(path_iot_2.3, "mrEmissions_version2.3.0.txt", sep=""), header=FALSE, sep="\t", dec=".",
skip=2, nrows=85, stringsAsFactors = FALSE)
emissions_2.3 <- emissions_2.3 %>% select(-V2, -V3) %>% filter(grepl('CH4|CO2|N2O', V1))
emissions_2.3 <- read.table(paste(path_iot_2.3, "mrEmissions_version2.3.0.txt", sep=""), header=FALSE, sep="\t", dec=".",
skip=2, nrows=170, stringsAsFactors = FALSE)
emissions_2.3 <- emissions_2.3 %>% select(-V2, -V3) %>% filter(grepl('CH4|CO2|N2O', V1))
GHG_item_2.3 <- emissions_2.3$V1
GHG_item_2.3
emissions_2.3 <- read.table(paste(path_iot_2.3, "mrEmissions_version2.3.0.txt", sep=""), header=FALSE, sep="\t", dec=".",
skip=2, nrows=204, stringsAsFactors = FALSE)
emissions_2.3 <- emissions_2.3 %>% select(-V3) %>% filter(V3=="air") %>% filter(grepl('CH4|CO2|N2O', V1))
emissions_2.3$V3
emissions_2.3$V1
emissions_2.3 <- emissions_2.3 %>% select(-V3) %>% filter(V2=="air")
emissions_2.3 <- read.table(paste(path_iot_2.3, "mrEmissions_version2.3.0.txt", sep=""), header=FALSE, sep="\t", dec=".",
skip=2, nrows=204, stringsAsFactors = FALSE)
emissions_2.3$V2
emissions_2.3 <- emissions_2.3 %>% select(-V3) %>% filter(V2==" air")
emissions_2.3$V1
grepl('CH4|CO2|N2O', emissions_2.3$V1)
emissions_2.3 <- emissions_2.3 %>% select(-V3) %>% filter(V2==" air") %>% filter(grepl('CH4|CO2|N2O', V1))
emissions_2.3 <- emissions_2.3 %>% filter(grepl('CH4|CO2|N2O', V1))
GHG_item_2.3 <- emissions_2.3$V1
GHG_item_2.3
a <- read.table(paste(path_iot_2.3, "mrEmissions_version2.3.0.txt", sep=""), header=FALSE, sep="\t", dec=".",
nrows=2, stringsAsFactors = FALSE)
a
a[,1:10]
(a[1,])
table(a[1,])
table(a[1,1:10])
(a[1,1:10])
class(a[1,1:10])
?read.table
table(a[1,1:10])
freq(a[1,1:10])
frequency(a[1,1:10])
(a[1,1:100])
(a[1,1:100])[1]
(a[1,1:100])[4]
as.character(a[1,])
table(as.character(a[1,]))
emissions_2.3 <- read.table(paste(path_iot_2.3, "mrEmissions_pxp_version2.3.0.txt", sep=""), header=FALSE, sep="\t", dec=".",
skip=2, nrows=204, stringsAsFactors = FALSE)
emissions_2.3 <- emissions_2.3 %>% select(-V3) %>% filter(V2==" air") %>% filter(grepl('CH4|CO2|N2O', V1))
GHG_item_2.3 <- emissions_2.3$V1
emissions_2.3 <- emissions_2.3 %>% select(-V1)
emissions_2.3 <- emissions_2.3 %>% select(-V1, -V2)
emissions_2.3 <- emissions_2.3 %>% select(-V2)
GHG_item_2.3
IND_fd_exio
IND_fd_ex
IND_idx_ex
View(emissions_2.3[,IND_idx_ex])
View(cbind(GHG_item_2.3, emissions_2.3[,IND_idx_ex]))
emissions <- read.table(paste(path_iot, "mrEmissions_version2.2.2.txt", sep=""), header=FALSE, sep="\t", dec=".",
skip=2, nrows=85, stringsAsFactors = FALSE)
emissions <- emissions %>% select(-V2, -V3) %>% filter(grepl('CH4|CO2|N2O', V1))
GHG_item <- emissions$V1
emissions <- emissions %>% select(-V1)
View(cbind(GHG_item, emissions[,IND_idx_ex]))
View(cbind(GHG_item, emissions[,BRA_idx_ex]))
emissions <- read.table(paste(path_iot, "mrEmissions_version2.2.2.txt", sep=""), header=FALSE, sep="\t", dec=".",
skip=2, nrows=85, stringsAsFactors = FALSE)
emissions <- emissions %>% select(-V2, -V3) %>% filter(grepl('CH4|CO2|N2O|Agriculture', V1))
GHG_item <- emissions$V1
emissions <- emissions %>% select(-V1)
path_iot_2.3 <- 'C:/Users/min/SharePoint/DLE - Documents/IO/Data - EXIOBASE/extension2.3.0/'
emissions_2.3 <- read.table(paste(path_iot_2.3, "mrEmissions_pxp_version2.3.0.txt", sep=""), header=FALSE, sep="\t", dec=".",
skip=2, nrows=204, stringsAsFactors = FALSE)
emissions_2.3 <- emissions_2.3 %>% select(-V3) %>% filter(V2==" air") %>% filter(grepl('CH4|CO2|N2O|Agriculture', V1))
GHG_item_2.3 <- emissions_2.3$V1
emissions_2.3 <- emissions_2.3 %>% select(-V1, -V2)
View(cbind(GHG_item, emissions[,IND_idx_ex]))
rowSums(emissions[,IND_idx_ex])
rowSums(emissions[,BRA_idx_ex])
rowSums(cbind(GHG_item_2.3, emissions_2.3[,IND_idx_ex]))
rowSums(emissions_2.3[,IND_idx_ex])
GHG_item_2.3
rowSums(emissions_2.3[,BRA_idx_ex])
rowSums(emissions_2.3[,IND_idx_ex])
View(cbind(GHG_item_2.3, emissions_2.3[,IND_idx_ex]))
EX_catnames[22]
EX_catnames[28]
EX_catnames[21]
View(cbind(GHG_item_2.3, emissions_2.3[,BRA_idx_ex]))
emissions_2.3[37,IND_idx_ex]
BRA1_fd_sum <- BRA1_hh %>% left_join(BRA1_fd) %>% group_by(item_food) %>% summarise(val=sum(val_food))
BRA1_fd_sum <- selectDBdata(tables='BRA1_FOOD') %>% select(-survey) %>% group_by(item) %>% summarise(val=sum(val_food))
BRA1_fd_sum <- selectDBdata(tables='BRA1_FOOD') %>% select(-survey) %>% group_by(item) %>% summarise(val=sum(val_tot))
View(BRA1_fd_sum)
ICP_catnames[1:40]
rm(BRA2*)
rm(ls(pattern='^BRA2'))
rm(ls(pattern='BRA2'))
rm(ls(pattern='BRA2'))
rm(ls(pattern="BRA2"))
rm(list=ls(pattern="BRA2"))
gc()
install.packages("tabulizer")
install.packages("pdftables")
library(pdftables)
GHG_item_2.3
path_iot_2.3 <- 'C:/Users/min/SharePoint/DLE - Documents/IO/Data - EXIOBASE/extension2.3.0/'
emissions_2.3 <- read.table(paste(path_iot_2.3, "mrEmissions_pxp_version2.3.0.txt", sep=""), header=FALSE, sep="\t", dec=".",
skip=2, nrows=204, stringsAsFactors = FALSE)
emissions_2.3 <- emissions_2.3 %>% select(-V3) %>% filter(V2==" air") %>% filter(grepl('CH4|CO2|N2O', V1))
GHG_item_2.3 <- emissions_2.3$V1
emissions_2.3 <- emissions_2.3 %>% select(-V1, -V2)
GHG_item_2.3
exio_ctys
wb <- XLConnect::loadWorkbook("H:/MyDocuments/IO work/Bridging/CES-COICOP/ICP_EXIO_Qual_UN_Edited.xlsx")
bridge_ICP_EXIO_q  <- XLConnect::readWorksheet(wb, "ICP_EXIO_Qual_UN2", header=TRUE,
forceConversion=T, endCol=201)
ICP_catnames <- bridge_ICP_EXIO_q[,1]
ICP_catnames
BRA1_hh <- selectDBdata(ID, WEIGHT, INCOME, CONSUMPTION, EXPENDITURE, tables='BRA1_HH')
BRA1_fd <- selectDBdata(tables='BRA1_FOOD') %>% select(-survey) %>% rename(item_food = item, val_food = val_tot, qty_food = qty_tot, unit_food = unit) %>%
group_by(id) %>% summarise(val_food=sum(val_food, na.rm = TRUE), qty_food=sum(qty_food, na.rm = TRUE))
BRA1_fuel <- selectDBdata(tables='BRA1_FUEL') %>% select(-survey) %>% rename(item_fuel = fuel, val_fuel = val_tot, qty_fuel = qty_tot, unit_fuel = unit)%>%
group_by(id) %>% summarise(val_fuel=sum(val_fuel, na.rm = TRUE), qty_fuel=sum(qty_fuel, na.rm = TRUE))
BRA1_oth <- selectDBdata(tables='BRA1_OTHCON') %>% select(-survey) %>% rename(item_oth = item, val_oth = val_tot)%>%
group_by(id) %>% summarise(val_oth=sum(val_oth, na.rm = TRUE))
BRA1 <- BRA1_hh %>% left_join(BRA1_fd) %>% left_join(BRA1_fuel) %>% left_join(BRA1_oth) %>% rowwise() %>% mutate(valsum=sum(val_oth, val_food, val_fuel, na.rm = TRUE)) %>%
arrange(val_food)
BRA1_nf <- BRA1 %>% filter(is.na(val_food))
source("P:/ene.general/DecentLivingEnergy/Surveys/Generic function to access database.R")
BRA1_hh <- selectDBdata(ID, WEIGHT, INCOME, CONSUMPTION, EXPENDITURE, tables='BRA1_HH')
BRA1_fd <- selectDBdata(tables='BRA1_FOOD') %>% select(-survey) %>% rename(item_food = item, val_food = val_tot, qty_food = qty_tot, unit_food = unit) %>%
group_by(id) %>% summarise(val_food=sum(val_food, na.rm = TRUE), qty_food=sum(qty_food, na.rm = TRUE))
BRA1_fuel <- selectDBdata(tables='BRA1_FUEL') %>% select(-survey) %>% rename(item_fuel = fuel, val_fuel = val_tot, qty_fuel = qty_tot, unit_fuel = unit)%>%
group_by(id) %>% summarise(val_fuel=sum(val_fuel, na.rm = TRUE), qty_fuel=sum(qty_fuel, na.rm = TRUE))
BRA1_oth <- selectDBdata(tables='BRA1_OTHCON') %>% select(-survey) %>% rename(item_oth = item, val_oth = val_tot)%>%
group_by(id) %>% summarise(val_oth=sum(val_oth, na.rm = TRUE))
BRA1 <- BRA1_hh %>% left_join(BRA1_fd) %>% left_join(BRA1_fuel) %>% left_join(BRA1_oth) %>% rowwise() %>% mutate(valsum=sum(val_oth, val_food, val_fuel, na.rm = TRUE)) %>%
arrange(val_food)
BRA1_nf <- BRA1 %>% filter(is.na(val_food))
BRA1_nf
BRA1_fd_sum <- selectDBdata(tables='BRA1_FOOD') %>% select(-survey) %>% group_by(item) %>% summarise(val=sum(val_tot))
BRA1_fd_sum
BRA1_fd_sum$item
write.table(BRA1_fd_sum$item, "clipboard", sep="\t", row.names = FALSE, col.names = TRUE)
BRA1_fd_sum[1:10,]
(BRA1_fd_sum %>% arrange(val))[1:10,]
write.table((BRA1_fd_sum %>% arrange(val))[1:10,], "clipboard", sep="\t", row.names = FALSE, col.names = TRUE)
view((BRA1_fd_sum %>% arrange(val)))
BRA0_hh <- selectDBdata(ID, WEIGHT, INCOME, CONSUMPTION, EXPENDITURE, tables='BRA0_HH')
BRA0_fd <- selectDBdata(tables='BRA0_FOOD') %>% select(-survey) %>% rename(item_food = item, val_food = val_tot, qty_food = qty_tot, unit_food = unit) %>%
group_by(id) %>% summarise(val_food=sum(val_food, na.rm = TRUE), qty_food=sum(qty_food, na.rm = TRUE))
BRA0_fuel <- selectDBdata(tables='BRA0_FUEL') %>% select(-survey) %>% rename(item_fuel = fuel, val_fuel = val_tot, qty_fuel = qty_tot, unit_fuel = unit)%>%
group_by(id) %>% summarise(val_fuel=sum(val_fuel, na.rm = TRUE), qty_fuel=sum(qty_fuel, na.rm = TRUE))
BRA0_oth <- selectDBdata(tables='BRA0_OTHCON') %>% select(-survey) %>% rename(item_oth = item, val_oth = val_tot)%>%
group_by(id) %>% summarise(val_oth=sum(val_oth, na.rm = TRUE))
BRA0 <- BRA0_hh %>% left_join(BRA0_fd) %>% left_join(BRA0_fuel) %>% left_join(BRA0_oth) %>% rowwise() %>% mutate(valsum=sum(val_oth, val_food, val_fuel, na.rm = TRUE)) %>%
arrange(val_food)
BRA0_nf <- BRA0 %>% filter(is.na(val_food))
BRA1_fd_sum <- selectDBdata(tables='BRA0_FOOD') %>% select(-survey) %>% group_by(item) %>% summarise(val=sum(val_tot))
BRA0_fd_sum <- selectDBdata(tables='BRA0_FOOD') %>% select(-survey) %>% group_by(item) %>% summarise(val=sum(val_tot))
BRA0_fd_sum
BRA0_fd_sum <- selectDBdata(tables='BRA0_FOOD') %>% select(-survey) %>% group_by(item) %>% summarise(val=sum(val_tot)) %>% arrange(val)
BRA0_fd_sum
view(BRA0_fd_sum)
materials <- read.table(paste(path_iot, "mrMaterials_version2.2.0.txt", sep=""), header=FALSE, sep="\t", dec=".", skip=2)
path_iot <- "P:/ene.general/DecentLivingEnergy/IO/Data - EXIOBASE/mrIOT_PxP_ita_coefficient_version2.2.2/"
path_sut <- "P:/ene.general/DecentLivingEnergy/IO/Data - EXIOBASE/mrSUT_version2.2.2/"
materials <- read.table(paste(path_iot, "mrMaterials_version2.2.0.txt", sep=""), header=FALSE, sep="\t", dec=".", skip=2)
materials <- materials[,c(-1,-2)]
nature_input_idx <- 1:19   # number of rows for E-carrier use after removing the row headers
energy_use <- materials[nature_input_idx,]  # The energy extension has not intensities but total consumptions.
tot_use <- read.table(paste(path_sut, "mrUse_version2.2.2.txt", sep=""), header=FALSE, sep="\t", dec=".", skip=2)
tot_use <- tot_use[,c(-1,-2,-3)]
tot_demand <- rowSums(final_demand) + rowSums(tot_use)
TJ_per_MTOE <- 41870
TWh_per_MTOE <- 11.63
final_demand <- read.table(paste(path_iot, "mrFinalDemand_version2.2.2.txt", sep=""), header=FALSE, sep="\t", dec=".", skip=2)
final_demand <- final_demand[,c(-1,-2,-3)]
tot_demand <- rowSums(final_demand) + rowSums(tot_use)
energy_use <- materials[nature_input_idx,]  # The energy extension has not intensities but total consumptions.
y <- 1/tot_demand
y[is.infinite(y)] <- 0
energy_int <- as.matrix(energy_use) %*% diag(y)   # Derive energy intensities by dividing by total demand per sector TJ/M.EUR = MJ/EUR
indirect_E_int <- energy_int %*% as.matrix(L_inverse)   # (intensity by sector) * (I-A)^-1
load(file="H:/MyDocuments/IO work/DLE_scripts/Saved tables/L_inverse.Rda")
indirect_E_int <- energy_int %*% as.matrix(L_inverse)   # (intensity by sector) * (I-A)^-1
save(indirect_E_int, file="H:/MyDocuments/IO work/DLE_scripts/Saved tables/indirect_E_int.Rda")
IND_idx_ex
IND_idx_ex
exio_ctys <- c("AT", "BE", "BG", "CY", "CZ", "DE", "DK", "EE", "ES", "FI",
"FR", "GR", "HU", "IE", "IT", "LT", "LU", "LV", "MT", "NL",
"PL", "PT", "RO", "SE", "SI", "SK", "GB", "US", "JP", "CN",
"CA", "KR", "BR", "IN", "MX", "RU", "AU", "CH", "TR", "TW",
"NO", "ID", "ZA", "WA", "WL", "WE", "WF", "WM")
n_draw <- 1000
D_val_uncertainty <- 0  # or 1 : Whether to include uncertainty analysis for valuation mtx - margins and tax rates
draw_count <- 1
options(digits=3)
IND_place <- which(exio_ctys=="IN")
IND_idx_fd <- seq(7*(IND_place-1)+1, 7*IND_place)   # 7 final demand columns per country
IND_idx_ex <- seq(200*(IND_place-1)+1, 200*IND_place)   # 7 final demand columns per country
IND_fd_ex <- matrix(final_demand[,IND_idx_fd[1]], nrow=200) / EXR_EUR$r  # to M.USD (2007 MER)
IND_fd_exio <- rowSums(IND_fd_ex) # Sum all HH FD across countries
IND_idx_ex
indirect_E_int[,ind_ex]
indirect_E_int[,IND_idx_ex]
colSums(indirect_E_int[,IND_idx_ex])
View(cbind(t(EX_catnames), colSums(indirect_E_int[,IND_idx_ex])) )
BRA_place <- which(exio_ctys=="BR")
BRA_idx_fd <- seq(7*(BRA_place-1)+1, 7*BRA_place)   # 7 final demand columns per country
BRA_idx_ex <- seq(200*(BRA_place-1)+1, 200*BRA_place)   # 7 final demand columns per country
View(cbind(t(EX_catnames), colSums(indirect_E_int[,BRA_idx_ex])) )
IDN_idx_ex <- seq(200*(which(exio_ctys=="ID")-1)+1, 200*which(exio_ctys=="ID"))   # 7 final demand columns per country
View(cbind(t(EX_catnames), colSums(indirect_E_int[,IDN_idx_ex])) )
ZAF_idx_ex <- seq(200*(which(exio_ctys=="ZA")-1)+1, 200*which(exio_ctys=="ZA"))   # 7 final demand columns per country
View(cbind(t(EX_catnames), colSums(indirect_E_int[,ZAF_idx_ex])) )
View(cbind(t(EX_catnames), colSums(indirect_E_int[,IND_idx_ex])) )
lsos
