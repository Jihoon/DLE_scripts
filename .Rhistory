names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
p.to.f.prod <- rbind(p.to.f.prod, a[3,-1] / c(colSums(tpei.nature[,cty.idx.ex[sects]])))
p.to.f.use <- rbind(p.to.f.use, a[3,-1] / c(colSums(tpei.USE[,cty.idx.ex[sects]])))
}
# par(mfrow = c(7,7), mar = c(0, 0, 1, 0))
# for (i in 1:49) {
par(mfrow = c(3,4), mar = c(2, 1, 2, 1))
for (i in cty_set) {
plot(as.numeric(elec.share[i+1,]), type="o", col="blue", ylim=c(0,1), axes=FALSE, ann=FALSE)
axis(1, at=1:3, lab=c("Cement","Steel","Alu"))
axis(2, las=1, at=seq(0, 1, 0.1))
# box()
grid(NA, 5, lwd = 1)
lines(as.numeric(p.to.f.use[i+1,]), type="o", pch=22, lty=2, col="red")
title(countrycode(exio_ctys[i], "iso2c", "iso3c"))
}
legend(1, 1, c("Electricity share","Final to Primary"), cex=1.0,
col=c("blue","red"), pch=21:22, lty=1:2)
dev.off()
# Countries with n
EX_catnames
sects <- 1:200
names(sects) <- EX_catnames
elec.share <- data.frame(matrix(ncol=3))
names(elec.share) <- names(sects)
elec.share
names(sects)
write.table(sum.out, "clipboard", sep="\t", row.names = TRUE, col.names = TRUE)
a <- sum.out[1:length(sects),] + sum.out[(length(sects)+1):(2*length(sects)),]
a <- a %>% mutate(EXIO = t(EX_catnames)) %>% select(EXIO, everything())
write.table(a, "clipboard", sep="\t", row.names = TRUE, col.names = TRUE)
### Additional outputs for FE meeting w/ Volker & Keywan 27/4/2018
sects <- 1:200
names(sects) <- EX_catnames
# sects <- c(Beef=43, Pork=44, Poultry=45) # Cement, Steel, Aluminum #
# sects <- c(Cement=101, Steel=104, Alu=108) # Cement, Steel, Aluminum
elec.idx <- grep("Electricity ", carrier.name.fin)
cty.idx.ex <- IND_idx_ex
NENE <- c(colSums(tfei.sub[[1]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[1]][-elec.idx, cty.idx.ex[sects]]))
NTRA <- c(colSums(tfei.sub[[2]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[2]][-elec.idx, cty.idx.ex[sects]]))
TAVI <- c(colSums(tfei.sub[[3]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[3]][-elec.idx, cty.idx.ex[sects]]))
TMAR <- c(colSums(tfei.sub[[4]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[4]][-elec.idx, cty.idx.ex[sects]]))
TOTH <- c(colSums(tfei.sub[[5]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[5]][-elec.idx, cty.idx.ex[sects]]))
TRAI <- c(colSums(tfei.sub[[6]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[6]][-elec.idx, cty.idx.ex[sects]]))
TROA <- c(colSums(tfei.sub[[7]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[7]][-elec.idx, cty.idx.ex[sects]]))
TOTL.F <- c(colSums(tfei.exio[elec.idx,cty.idx.ex[sects]]),colSums(tfei.exio[-elec.idx,cty.idx.ex[sects]]))
TOTL.P.prod <- c(colSums(tpei.nature[,cty.idx.ex[sects]]))
TOTL.P.use <- c(colSums(tpei.USE[,cty.idx.ex[sects]]))
sum.out <- data.frame(NENE, NTRA, TAVI, TMAR, TOTH, TRAI, TROA, TOTL.F, TOTL.P.prod, TOTL.P.use)
row.names(sum.out) <- c(paste0(names(sects), ".elec"), paste0(names(sects), ".non-elec"))
write.table(sum.out, "clipboard", sep="\t", row.names = TRUE, col.names = TRUE)
View(sum.out)
write.table(sum.out, "clipboard", sep="\t", row.names = TRUE, col.names = TRUE)
elec.share <- data.frame(matrix(ncol=200))
names(elec.share) <- names(sects)
a <- data.frame(name=carrier.name.fin, tfei.exio[,IND_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
a <- data.frame(name=carrier.name.fin, tfei.exio[,BRA_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
a <- data.frame(name=carrier.name.fin, tfei.exio[,ZAF_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
GER_place <- which(exio_ctys=="DE")
GER_idx_ex <- seq(200*(GER_place-1)+1, 200*GER_place)   # 200 EXIO comodities
a <- data.frame(name=carrier.name.fin, tfei.exio[,GER_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
USA_place <- which(exio_ctys=="US")
USA_idx_ex <- seq(200*(USA_place-1)+1, 200*USA_place)   # 200 EXIO comodities
a <- data.frame(name=carrier.name.fin, tfei.exio[,USA_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
CHN_place <- which(exio_ctys=="CN")
CHN_idx_ex <- seq(200*(CHN_place-1)+1, 200*CHN_place)   # 200 EXIO comodities
a <- data.frame(name=carrier.name.fin, tfei.exio[,CHN_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
elec.share <- elec.share %>% slice(-1) %>% mutate(country=c("IND", "BRA", "ZAF", "GER", "USA", "CHN")) %>% select(country, everything())
write.table(elec.share, "clipboard", sep="\t", row.names = FALSE, col.names = TRUE)
# Derive elec share and f/p raio for all countries
elec.share <- data.frame(matrix(ncol=3))
names(elec.share) <- names(sects)
p.to.f.prod <- data.frame(matrix(ncol=3))
names(p.to.f.prod) <- names(sects)
p.to.f.use <- data.frame(matrix(ncol=3))
names(p.to.f.use) <- names(sects)
for (i in 1:49) {
cty.idx.ex <- seq(200*(i-1)+1, 200*i)
a <- data.frame(name=carrier.name.fin, tfei.exio[,cty.idx.ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
p.to.f.prod <- rbind(p.to.f.prod, a[3,-1] / c(colSums(tpei.nature[,cty.idx.ex[sects]])))
p.to.f.use <- rbind(p.to.f.use, a[3,-1] / c(colSums(tpei.USE[,cty.idx.ex[sects]])))
}
# par(mfrow = c(7,7), mar = c(0, 0, 1, 0))
# for (i in 1:49) {
par(mfrow = c(3,4), mar = c(2, 1, 2, 1))
for (i in cty_set) {
plot(as.numeric(elec.share[i+1,]), type="o", col="blue", ylim=c(0,1), axes=FALSE, ann=FALSE)
axis(1, at=1:3, lab=c("Cement","Steel","Alu"))
axis(2, las=1, at=seq(0, 1, 0.1))
# box()
grid(NA, 5, lwd = 1)
lines(as.numeric(p.to.f.use[i+1,]), type="o", pch=22, lty=2, col="red")
title(countrycode(exio_ctys[i], "iso2c", "iso3c"))
}
legend(1, 1, c("Electricity share","Final to Primary"), cex=1.0,
col=c("blue","red"), pch=21:22, lty=1:2)
dev.off()
# Countries with nice-looking trend
cty_set <-  which(exio_ctys %in% c("BE", "SI", "CZ", "LV", "NL", "IN", "HU", "CN", "EE", "TW", "KR", "ZA"))
n.sect = 200
# Derive elec share and f/p raio for all countries
elec.share <- data.frame(matrix(ncol=n.sect))
names(elec.share) <- names(sects)
p.to.f.prod <- data.frame(matrix(ncol=n.sect))
names(p.to.f.prod) <- names(sects)
p.to.f.use <- data.frame(matrix(ncol=n.sect))
names(p.to.f.use) <- names(sects)
for (i in 1:49) {
cty.idx.ex <- seq(200*(i-1)+1, 200*i)
a <- data.frame(name=carrier.name.fin, tfei.exio[,cty.idx.ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
p.to.f.prod <- rbind(p.to.f.prod, a[3,-1] / c(colSums(tpei.nature[,cty.idx.ex[sects]])))
p.to.f.use <- rbind(p.to.f.use, a[3,-1] / c(colSums(tpei.USE[,cty.idx.ex[sects]])))
}
# par(mfrow = c(7,7), mar = c(0, 0, 1, 0))
# for (i in 1:49) {
par(mfrow = c(3,4), mar = c(2, 1, 2, 1))
for (i in cty_set) {
plot(as.numeric(elec.share[i+1,]), type="o", col="blue", ylim=c(0,1), axes=FALSE, ann=FALSE)
axis(1, at=1:3, lab=c("Cement","Steel","Alu"))
axis(2, las=1, at=seq(0, 1, 0.1))
# box()
grid(NA, 5, lwd = 1)
lines(as.numeric(p.to.f.use[i+1,]), type="o", pch=22, lty=2, col="red")
title(countrycode(exio_ctys[i], "iso2c", "iso3c"))
}
legend(1, 1, c("Electricity share","Final to Primary"), cex=1.0,
col=c("blue","red"), pch=21:22, lty=1:2)
dev.off()
elec.share
sects <- c(Cement=101, Steel=104, Alu=108) # Cement, Steel, Aluminum
names(sects) <- EX_catnames[sects]
n.sect = length(sects)
elec.share <- data.frame(matrix(ncol=n.sect))
names(elec.share) <- names(sects)
a <- data.frame(name=carrier.name.fin, tfei.exio[,IND_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
a <- data.frame(name=carrier.name.fin, tfei.exio[,BRA_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
a <- data.frame(name=carrier.name.fin, tfei.exio[,ZAF_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
# Try GER and USA
GER_place <- which(exio_ctys=="DE")
GER_idx_ex <- seq(200*(GER_place-1)+1, 200*GER_place)   # 200 EXIO comodities
a <- data.frame(name=carrier.name.fin, tfei.exio[,GER_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
USA_place <- which(exio_ctys=="US")
USA_idx_ex <- seq(200*(USA_place-1)+1, 200*USA_place)   # 200 EXIO comodities
a <- data.frame(name=carrier.name.fin, tfei.exio[,USA_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
CHN_place <- which(exio_ctys=="CN")
CHN_idx_ex <- seq(200*(CHN_place-1)+1, 200*CHN_place)   # 200 EXIO comodities
a <- data.frame(name=carrier.name.fin, tfei.exio[,CHN_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
elec.share <- elec.share %>% slice(-1) %>% mutate(country=c("IND", "BRA", "ZAF", "GER", "USA", "CHN")) %>% select(country, everything())
write.table(elec.share, "clipboard", sep="\t", row.names = FALSE, col.names = TRUE)
# Derive elec share and f/p raio for all countries
elec.share <- data.frame(matrix(ncol=n.sect))
names(elec.share) <- names(sects)
p.to.f.prod <- data.frame(matrix(ncol=n.sect))
names(p.to.f.prod) <- names(sects)
p.to.f.use <- data.frame(matrix(ncol=n.sect))
names(p.to.f.use) <- names(sects)
for (i in 1:49) {
cty.idx.ex <- seq(200*(i-1)+1, 200*i)
a <- data.frame(name=carrier.name.fin, tfei.exio[,cty.idx.ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
p.to.f.prod <- rbind(p.to.f.prod, a[3,-1] / c(colSums(tpei.nature[,cty.idx.ex[sects]])))
p.to.f.use <- rbind(p.to.f.use, a[3,-1] / c(colSums(tpei.USE[,cty.idx.ex[sects]])))
}
# par(mfrow = c(7,7), mar = c(0, 0, 1, 0))
# for (i in 1:49) {
par(mfrow = c(3,4), mar = c(2, 1, 2, 1))
for (i in cty_set) {
plot(as.numeric(elec.share[i+1,]), type="o", col="blue", ylim=c(0,1), axes=FALSE, ann=FALSE)
axis(1, at=1:3, lab=c("Cement","Steel","Alu"))
axis(2, las=1, at=seq(0, 1, 0.1))
# box()
grid(NA, 5, lwd = 1)
lines(as.numeric(p.to.f.use[i+1,]), type="o", pch=22, lty=2, col="red")
title(countrycode(exio_ctys[i], "iso2c", "iso3c"))
}
legend(1, 1, c("Electricity share","Final to Primary"), cex=1.0,
col=c("blue","red"), pch=21:22, lty=1:2)
dev.off()
par(mfrow = c(3,4), mar = c(2, 1, 2, 1))
for (i in cty_set) {
plot(as.numeric(elec.share[i+1,]), type="o", col="blue", ylim=c(0,1), axes=FALSE, ann=FALSE)
axis(1, at=1:3, lab=c("Cement","Steel","Alu"))
axis(2, las=1, at=seq(0, 1, 0.1))
# box()
grid(NA, 5, lwd = 1)
lines(as.numeric(p.to.f.use[i+1,]), type="o", pch=22, lty=2, col="red")
title(countrycode(exio_ctys[i], "iso2c", "iso3c"))
}
legend(1, 1, c("Electricity share","Final to Primary"), cex=1.0,
col=c("blue","red"), pch=21:22, lty=1:2)
# sects <- c(Beef=43, Pork=44, Poultry=45) # Cement, Steel, Aluminum #
sects <- c(Cement=101, Steel=104, Alu=108) # Cement, Steel, Aluminum
names(sects) <- EX_catnames[sects]
elec.idx <- grep("Electricity ", carrier.name.fin)
cty.idx.ex <- IND_idx_ex
NENE <- c(colSums(tfei.sub[[1]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[1]][-elec.idx, cty.idx.ex[sects]]))
NTRA <- c(colSums(tfei.sub[[2]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[2]][-elec.idx, cty.idx.ex[sects]]))
TAVI <- c(colSums(tfei.sub[[3]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[3]][-elec.idx, cty.idx.ex[sects]]))
TMAR <- c(colSums(tfei.sub[[4]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[4]][-elec.idx, cty.idx.ex[sects]]))
TOTH <- c(colSums(tfei.sub[[5]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[5]][-elec.idx, cty.idx.ex[sects]]))
TRAI <- c(colSums(tfei.sub[[6]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[6]][-elec.idx, cty.idx.ex[sects]]))
TROA <- c(colSums(tfei.sub[[7]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[7]][-elec.idx, cty.idx.ex[sects]]))
TOTL.F <- c(colSums(tfei.exio[elec.idx,cty.idx.ex[sects]]),colSums(tfei.exio[-elec.idx,cty.idx.ex[sects]]))
TOTL.P.prod <- c(colSums(tpei.nature[,cty.idx.ex[sects]]))
TOTL.P.use <- c(colSums(tpei.USE[,cty.idx.ex[sects]]))
sum.out <- data.frame(NENE, NTRA, TAVI, TMAR, TOTH, TRAI, TROA, TOTL.F, TOTL.P.prod, TOTL.P.use)
row.names(sum.out) <- c(paste0(names(sects), ".elec"), paste0(names(sects), ".non-elec"))
write.table(sum.out, "clipboard", sep="\t", row.names = TRUE, col.names = TRUE)
TROA
names(tfei.sub)
sects <- c(Beef=43, Pork=44, Poultry=45) # Cement, Steel, Aluminum #
# sects <- c(Cement=101, Steel=104, Alu=108) # Cement, Steel, Aluminum
names(sects) <- EX_catnames[sects]
elec.idx <- grep("Electricity ", carrier.name.fin)
cty.idx.ex <- IND_idx_ex
NENE <- c(colSums(tfei.sub[[1]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[1]][-elec.idx, cty.idx.ex[sects]]))
NTRA <- c(colSums(tfei.sub[[2]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[2]][-elec.idx, cty.idx.ex[sects]]))
TAVI <- c(colSums(tfei.sub[[3]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[3]][-elec.idx, cty.idx.ex[sects]]))
TMAR <- c(colSums(tfei.sub[[4]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[4]][-elec.idx, cty.idx.ex[sects]]))
TOTH <- c(colSums(tfei.sub[[5]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[5]][-elec.idx, cty.idx.ex[sects]]))
TRAI <- c(colSums(tfei.sub[[6]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[6]][-elec.idx, cty.idx.ex[sects]]))
TROA <- c(colSums(tfei.sub[[7]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[7]][-elec.idx, cty.idx.ex[sects]]))
TOTL.F <- c(colSums(tfei.exio[elec.idx,cty.idx.ex[sects]]),colSums(tfei.exio[-elec.idx,cty.idx.ex[sects]]))
TOTL.P.prod <- c(colSums(tpei.nature[,cty.idx.ex[sects]]))
TOTL.P.use <- c(colSums(tpei.USE[,cty.idx.ex[sects]]))
sum.out <- data.frame(NENE, NTRA, TAVI, TMAR, TOTH, TRAI, TROA, TOTL.F, TOTL.P.prod, TOTL.P.use)
row.names(sum.out) <- c(paste0(names(sects), ".elec"), paste0(names(sects), ".non-elec"))
write.table(sum.out, "clipboard", sep="\t", row.names = TRUE, col.names = TRUE)
# a <- sum.out[1:3,] + sum.out[4:6,]
a <- sum.out[1:length(sects),] + sum.out[(length(sects)+1):(2*length(sects)),]
a <- a %>% mutate(EXIO = t(EX_catnames)) %>% select(EXIO, everything())
write.table(a, "clipboard", sep="\t", row.names = TRUE, col.names = TRUE)
sects <- c(Beef=43, Pork=44, Poultry=45) # Cement, Steel, Aluminum #
# sects <- c(Cement=101, Steel=104, Alu=108) # Cement, Steel, Aluminum
names(sects) <- EX_catnames[sects]
elec.idx <- grep("Electricity ", carrier.name.fin)
cty.idx.ex <- IND_idx_ex
NENE <- c(colSums(tfei.sub[[1]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[1]][-elec.idx, cty.idx.ex[sects]]))
NTRA <- c(colSums(tfei.sub[[2]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[2]][-elec.idx, cty.idx.ex[sects]]))
TAVI <- c(colSums(tfei.sub[[3]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[3]][-elec.idx, cty.idx.ex[sects]]))
TMAR <- c(colSums(tfei.sub[[4]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[4]][-elec.idx, cty.idx.ex[sects]]))
TOTH <- c(colSums(tfei.sub[[5]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[5]][-elec.idx, cty.idx.ex[sects]]))
TRAI <- c(colSums(tfei.sub[[6]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[6]][-elec.idx, cty.idx.ex[sects]]))
TROA <- c(colSums(tfei.sub[[7]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[7]][-elec.idx, cty.idx.ex[sects]]))
TOTL.F <- c(colSums(tfei.exio[elec.idx,cty.idx.ex[sects]]),colSums(tfei.exio[-elec.idx,cty.idx.ex[sects]]))
TOTL.P.prod <- c(colSums(tpei.nature[,cty.idx.ex[sects]]))
TOTL.P.use <- c(colSums(tpei.USE[,cty.idx.ex[sects]]))
sum.out <- data.frame(NENE, NTRA, TAVI, TMAR, TOTH, TRAI, TROA, TOTL.F, TOTL.P.prod, TOTL.P.use)
row.names(sum.out) <- c(paste0(names(sects), ".elec"), paste0(names(sects), ".non-elec"))
write.table(sum.out, "clipboard", sep="\t", row.names = TRUE, col.names = TRUE)
# Compare elec shares of countries
n.sect = length(sects)
elec.share <- data.frame(matrix(ncol=n.sect))
names(elec.share) <- names(sects)
a <- data.frame(name=carrier.name.fin, tfei.exio[,IND_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
a <- data.frame(name=carrier.name.fin, tfei.exio[,BRA_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
a <- data.frame(name=carrier.name.fin, tfei.exio[,ZAF_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
# Try GER and USA
GER_place <- which(exio_ctys=="DE")
GER_idx_ex <- seq(200*(GER_place-1)+1, 200*GER_place)   # 200 EXIO comodities
a <- data.frame(name=carrier.name.fin, tfei.exio[,GER_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
USA_place <- which(exio_ctys=="US")
USA_idx_ex <- seq(200*(USA_place-1)+1, 200*USA_place)   # 200 EXIO comodities
a <- data.frame(name=carrier.name.fin, tfei.exio[,USA_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
CHN_place <- which(exio_ctys=="CN")
CHN_idx_ex <- seq(200*(CHN_place-1)+1, 200*CHN_place)   # 200 EXIO comodities
a <- data.frame(name=carrier.name.fin, tfei.exio[,CHN_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
elec.share <- elec.share %>% slice(-1) %>% mutate(country=c("IND", "BRA", "ZAF", "GER", "USA", "CHN")) %>% select(country, everything())
write.table(elec.share, "clipboard", sep="\t", row.names = FALSE, col.names = TRUE)
par(mfrow = c(7,7), mar = c(0, 0, 1, 0))
for (i in 1:49) {
# par(mfrow = c(3,4), mar = c(2, 1, 2, 1))
# for (i in cty_set) {
plot(as.numeric(elec.share[i+1,]), type="o", col="blue", ylim=c(0,1), axes=FALSE, ann=FALSE)
axis(1, at=1:3, lab=c("Cement","Steel","Alu"))
axis(2, las=1, at=seq(0, 1, 0.1))
# box()
grid(NA, 5, lwd = 1)
lines(as.numeric(p.to.f.use[i+1,]), type="o", pch=22, lty=2, col="red")
title(countrycode(exio_ctys[i], "iso2c", "iso3c"))
}
legend(1, 1, c("Electricity share","Final to Primary"), cex=1.0,
col=c("blue","red"), pch=21:22, lty=1:2)
elec.share
elec.share <- data.frame(matrix(ncol=n.sect))
names(elec.share) <- names(sects)
p.to.f.prod <- data.frame(matrix(ncol=n.sect))
names(p.to.f.prod) <- names(sects)
p.to.f.use <- data.frame(matrix(ncol=n.sect))
names(p.to.f.use) <- names(sects)
# Derive elec share and f/p raio for all countries
elec.share <- data.frame(matrix(ncol=n.sect))
names(elec.share) <- names(sects)
p.to.f.prod <- data.frame(matrix(ncol=n.sect))
names(p.to.f.prod) <- names(sects)
p.to.f.use <- data.frame(matrix(ncol=n.sect))
names(p.to.f.use) <- names(sects)
for (i in 1:49) {
cty.idx.ex <- seq(200*(i-1)+1, 200*i)
a <- data.frame(name=carrier.name.fin, tfei.exio[,cty.idx.ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
p.to.f.prod <- rbind(p.to.f.prod, a[3,-1] / c(colSums(tpei.nature[,cty.idx.ex[sects]])))
p.to.f.use <- rbind(p.to.f.use, a[3,-1] / c(colSums(tpei.USE[,cty.idx.ex[sects]])))
}
par(mfrow = c(7,7), mar = c(0, 0, 1, 0))
for (i in 1:49) {
# par(mfrow = c(3,4), mar = c(2, 1, 2, 1))
# for (i in cty_set) {
plot(as.numeric(elec.share[i+1,]), type="o", col="blue", ylim=c(0,1), axes=FALSE, ann=FALSE)
axis(1, at=1:3, lab=c("Cement","Steel","Alu"))
axis(2, las=1, at=seq(0, 1, 0.1))
# box()
grid(NA, 5, lwd = 1)
lines(as.numeric(p.to.f.use[i+1,]), type="o", pch=22, lty=2, col="red")
title(countrycode(exio_ctys[i], "iso2c", "iso3c"))
}
legend(1, 1, c("Electricity share","Final to Primary"), cex=1.0,
col=c("blue","red"), pch=21:22, lty=1:2)
sects <- c(Cement=101, Steel=104, Alu=108) # Cement, Steel, Aluminum
names(sects) <- EX_catnames[sects]
elec.idx <- grep("Electricity ", carrier.name.fin)
cty.idx.ex <- IND_idx_ex
NENE <- c(colSums(tfei.sub[[1]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[1]][-elec.idx, cty.idx.ex[sects]]))
NTRA <- c(colSums(tfei.sub[[2]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[2]][-elec.idx, cty.idx.ex[sects]]))
TAVI <- c(colSums(tfei.sub[[3]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[3]][-elec.idx, cty.idx.ex[sects]]))
TMAR <- c(colSums(tfei.sub[[4]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[4]][-elec.idx, cty.idx.ex[sects]]))
TOTH <- c(colSums(tfei.sub[[5]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[5]][-elec.idx, cty.idx.ex[sects]]))
TRAI <- c(colSums(tfei.sub[[6]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[6]][-elec.idx, cty.idx.ex[sects]]))
TROA <- c(colSums(tfei.sub[[7]][elec.idx, cty.idx.ex[sects]]),colSums(tfei.sub[[7]][-elec.idx, cty.idx.ex[sects]]))
TOTL.F <- c(colSums(tfei.exio[elec.idx,cty.idx.ex[sects]]),colSums(tfei.exio[-elec.idx,cty.idx.ex[sects]]))
TOTL.P.prod <- c(colSums(tpei.nature[,cty.idx.ex[sects]]))
TOTL.P.use <- c(colSums(tpei.USE[,cty.idx.ex[sects]]))
sum.out <- data.frame(NENE, NTRA, TAVI, TMAR, TOTH, TRAI, TROA, TOTL.F, TOTL.P.prod, TOTL.P.use)
row.names(sum.out) <- c(paste0(names(sects), ".elec"), paste0(names(sects), ".non-elec"))
write.table(sum.out, "clipboard", sep="\t", row.names = TRUE, col.names = TRUE)
# a <- sum.out[1:3,] + sum.out[4:6,]
a <- sum.out[1:length(sects),] + sum.out[(length(sects)+1):(2*length(sects)),]
a <- a %>% mutate(EXIO = t(EX_catnames)) %>% select(EXIO, everything())
write.table(a, "clipboard", sep="\t", row.names = TRUE, col.names = TRUE)
rowSums(tfei.elec[elec.idx, cty.idx.ex[sects]])/sum(tfei.elec[elec.idx, cty.idx.ex[sects]])
# Compare elec shares of countries
n.sect = length(sects)
elec.share <- data.frame(matrix(ncol=n.sect))
names(elec.share) <- names(sects)
a <- data.frame(name=carrier.name.fin, tfei.exio[,IND_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
a <- data.frame(name=carrier.name.fin, tfei.exio[,BRA_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
a <- data.frame(name=carrier.name.fin, tfei.exio[,ZAF_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
# Try GER and USA
GER_place <- which(exio_ctys=="DE")
GER_idx_ex <- seq(200*(GER_place-1)+1, 200*GER_place)   # 200 EXIO comodities
a <- data.frame(name=carrier.name.fin, tfei.exio[,GER_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
USA_place <- which(exio_ctys=="US")
USA_idx_ex <- seq(200*(USA_place-1)+1, 200*USA_place)   # 200 EXIO comodities
a <- data.frame(name=carrier.name.fin, tfei.exio[,USA_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
CHN_place <- which(exio_ctys=="CN")
CHN_idx_ex <- seq(200*(CHN_place-1)+1, 200*CHN_place)   # 200 EXIO comodities
a <- data.frame(name=carrier.name.fin, tfei.exio[,CHN_idx_ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
elec.share <- elec.share %>% slice(-1) %>% mutate(country=c("IND", "BRA", "ZAF", "GER", "USA", "CHN")) %>% select(country, everything())
write.table(elec.share, "clipboard", sep="\t", row.names = FALSE, col.names = TRUE)
# Derive elec share and f/p raio for all countries
elec.share <- data.frame(matrix(ncol=n.sect))
names(elec.share) <- names(sects)
p.to.f.prod <- data.frame(matrix(ncol=n.sect))
names(p.to.f.prod) <- names(sects)
p.to.f.use <- data.frame(matrix(ncol=n.sect))
names(p.to.f.use) <- names(sects)
for (i in 1:49) {
cty.idx.ex <- seq(200*(i-1)+1, 200*i)
a <- data.frame(name=carrier.name.fin, tfei.exio[,cty.idx.ex[sects]]) %>% mutate(elec=ifelse(row_number() %in% elec.idx, 1, 0) ) %>%
group_by(elec) %>% summarise_if(is.numeric, sum) %>% rbind(colSums(.))
names(a)[-1] <- names(sects)
elec.share <- rbind(elec.share, a[2,-1]/a[3,-1])
p.to.f.prod <- rbind(p.to.f.prod, a[3,-1] / c(colSums(tpei.nature[,cty.idx.ex[sects]])))
p.to.f.use <- rbind(p.to.f.use, a[3,-1] / c(colSums(tpei.USE[,cty.idx.ex[sects]])))
}
par(mfrow = c(7,7), mar = c(0, 0, 1, 0))
for (i in 1:49) {
# par(mfrow = c(3,4), mar = c(2, 1, 2, 1))
# for (i in cty_set) {
plot(as.numeric(elec.share[i+1,]), type="o", col="blue", ylim=c(0,1), axes=FALSE, ann=FALSE)
axis(1, at=1:3, lab=c("Cement","Steel","Alu"))
axis(2, las=1, at=seq(0, 1, 0.1))
# box()
grid(NA, 5, lwd = 1)
lines(as.numeric(p.to.f.use[i+1,]), type="o", pch=22, lty=2, col="red")
title(countrycode(exio_ctys[i], "iso2c", "iso3c"))
}
legend(1, 1, c("Electricity share","Final to Primary"), cex=1.0,
col=c("blue","red"), pch=21:22, lty=1:2)
### Additional outputs for FE meeting w/ Volker & Keywan 27/4/2018
sects <- 1:200
names(sects) <- EX_catnames
# sects <- c(Beef=43, Pork=44, Poultry=45) # Cement, Steel, Aluminum #
# sects <- c(Cement=101, Steel=104, Alu=108) # Cement, Steel, Aluminum
elec.idx <- grep("Electricity ", carrier.name.fin)
cty.idx.ex <- IND_idx_ex
NENE <- c(colSums(dfei.sub[[1]][elec.idx, cty.idx.ex[sects]]),colSums(dfei.sub[[1]][-elec.idx, cty.idx.ex[sects]]))
NTRA <- c(colSums(dfei.sub[[2]][elec.idx, cty.idx.ex[sects]]),colSums(dfei.sub[[2]][-elec.idx, cty.idx.ex[sects]]))
TAVI <- c(colSums(dfei.sub[[3]][elec.idx, cty.idx.ex[sects]]),colSums(dfei.sub[[3]][-elec.idx, cty.idx.ex[sects]]))
TMAR <- c(colSums(dfei.sub[[4]][elec.idx, cty.idx.ex[sects]]),colSums(dfei.sub[[4]][-elec.idx, cty.idx.ex[sects]]))
TOTH <- c(colSums(dfei.sub[[5]][elec.idx, cty.idx.ex[sects]]),colSums(dfei.sub[[5]][-elec.idx, cty.idx.ex[sects]]))
TRAI <- c(colSums(dfei.sub[[6]][elec.idx, cty.idx.ex[sects]]),colSums(dfei.sub[[6]][-elec.idx, cty.idx.ex[sects]]))
TROA <- c(colSums(dfei.sub[[7]][elec.idx, cty.idx.ex[sects]]),colSums(dfei.sub[[7]][-elec.idx, cty.idx.ex[sects]]))
TOTL.F <- c(colSums(dfei.exio[elec.idx,cty.idx.ex[sects]]),colSums(dfei.exio[-elec.idx,cty.idx.ex[sects]]))
TOTL.P.prod <- c(colSums(dpei.nature[,cty.idx.ex[sects]]))
TOTL.P.use <- c(colSums(dpei.USE[,cty.idx.ex[sects]]))
sum.out <- data.frame(NENE, NTRA, TAVI, TMAR, TOTH, TRAI, TROA, TOTL.F, TOTL.P.prod, TOTL.P.use)
row.names(sum.out) <- c(paste0(names(sects), ".elec"), paste0(names(sects), ".non-elec"))
write.table(sum.out, "clipboard", sep="\t", row.names = TRUE, col.names = TRUE)
# a <- sum.out[1:3,] + sum.out[4:6,]
a <- sum.out[1:length(sects),] + sum.out[(length(sects)+1):(2*length(sects)),]
a <- a %>% mutate(EXIO = t(EX_catnames)) %>% select(EXIO, everything())
write.table(a, "clipboard", sep="\t", row.names = TRUE, col.names = TRUE)
view(read.csv(paste0(EXIO3_path_fix, "S_2008.csv"), header = FALSE))
a = read.csv(paste0(EXIO3_path_fix, "S_2008.csv"), header = FALSE)[,IND_idx_ex]
a=a[(73*6+1):(73*6+200),]
a = read.csv(paste0(EXIO3_path_fix, "S_2008.csv"), header = FALSE)[,IND_idx_ex]
dim(a)
a_TROA = a[(73*6+1):(73*6+73),]
View(a_TROA)
colSums(a_TROA)
sort(colSums(a_TROA))
lsos(n=10)
EXIO3_path
gc()
ddd
d
d
lsos(n=10)
