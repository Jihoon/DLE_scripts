IND_inten_comb_all[,65]
IND_inten_comb_all[,65] <- 0  # Ignore other fuel now
xlcFreeMemory()
eHH <- t(IND_inten_comb_all %*% (IND_FD_ICP_AllHH * EXR_EUR$r))
xlcFreeMemory()
View(eHH)
eHH <- cbind(id = as.numeric(rownames(eHH)), eHH)
xlcFreeMemory()
eHH <- cbind(id = as.numeric(rownames(eHH)), eHH)
xlcFreeMemory()
eHH <- merge(eHH, IND_HH, by="id") %>% arrange(consumption)
xlcFreeMemory()
eHH <- t(IND_inten_comb_all %*% (IND_FD_ICP_AllHH * EXR_EUR$r))
xlcFreeMemory()
eHH <- cbind(id = as.numeric(rownames(eHH)), eHH)
xlcFreeMemory()
eHH <- merge(eHH, IND_HH, by="id") %>% arrange(consumption)
xlcFreeMemory()
View(eHH)
View(cbind(IND_inten_comb_all[1,], IND_FD_ICP_AllHH[,1:10]))
View(cbind(IND_inten_comb_all[1,], IND_FD_ICP_AllHH[,1:10]))
View(IND_FD_ICP_AllHH)
readFinalDemandfromDBAllHH = function(svy='IND1') {
xlcFreeMemory()
Food <- selectDBdata(ID, ITEM, VAL_TOT, tables=c(paste0(svy, '_FOOD')))
xlcFreeMemory()
OthCon <- selectDBdata(ID, ITEM, VAL_TOT, tables=c(paste0(svy, '_OTHCON')))
xlcFreeMemory()
Fuel <- selectDBdata(ID, FUEL, VAL_TOT, QTY_TOT, UNIT, tables=c(paste0(svy, '_FUEL')))
xlcFreeMemory()
HHold <- selectDBdata(ID, WEIGHT, CONSUMPTION, EXPENDITURE, HH_SIZE, tables=c(paste0(svy, '_HH')))
xlcFreeMemory()
Fuel <- Fuel %>% rename(item = fuel)
print(sum(is.na(HHold$consumption)))
HHold <- HHold %>%
arrange(consumption) %>%
mutate(cumpop = cumsum(weight)/sum(HHold$weight)) %>%
mutate(decile = cut(cumpop, breaks = seq(0, 1, 0.1),
labels=paste0("decile", 1:10), include.lowest = TRUE, ordered=TRUE))  %>%
filter(!is.na(consumption))
print(sum(is.na(HHold$consumption)))
a_dec <- rbind.fill(Food, OthCon, Fuel) %>% inner_join(HHold) %>%
# filter(!is.na(val_tot)) %>%
# mutate(fd_tot = val_tot*weight) %>%
group_by(id, item) %>%
summarise(fd_tot = sum(val_tot, na.rm = TRUE)) %>% # Non-weighted FD (to get energy/cap)
spread(id, fd_tot)
return(list(a_dec, HHold))
}
list[IND_FD_ALL, IND_HH] <- readFinalDemandfromDBAllHH('IND1')
View(IND_FD_ALL)
IND_FD_ALL_ICP <- IND_FD_ALL[-grep("taxes", IND_FD_ALL$item, ignore.case = TRUE), ]
IND_FD_ALL_ICP <- merge(IND_FD_ALL_ICP, IND_map[,c("CODE", "COICOP1", "COICOP2", "ITEM_DLE")],
by.x="item", by.y="ITEM_DLE", all.x = TRUE) %>% arrange(CODE)
IND_FD_ALL_ICP <- NAer(IND_FD_ALL_ICP[,2:(dim(IND_FD_ALL_ICP)[2]-3)]) # Faster than IND_FD_code[is.na(IND_FD_code)] <- 0
warnings()
View(IND_FD_ALL_ICP)
IND_FD_ICP_AllHH <- t(CES_ICP_IND) %*% as.matrix(IND_FD_ALL_ICP)
View(IND_FD_ICP_AllHH)
IND_inten_comb_all[,65]
xlcFreeMemory()
eHH <- t(IND_inten_comb_all %*% (IND_FD_ICP_AllHH * EXR_EUR$r))
xlcFreeMemory()
eHH <- cbind(id = as.numeric(rownames(eHH)), eHH)
xlcFreeMemory()
eHH <- merge(eHH, IND_HH, by="id") %>% arrange(consumption)
xlcFreeMemory()
View(eHH)
xlcFreeMemory()
eHH_cap <- cbind(eHH[,1], eHH[,2:(n_draw+1)] / eHH$hh_size, eHH[,(n_draw+2):dim(eHH)[2]])
View(eHH_cap)
a <- eHH_cap %>% filter(decile=="decile1") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile10") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
opar <- par()
par(mfrow=c(10,1))
a <- eHH_cap %>% filter(decile=="decile1") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile2") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile3") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile4") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile5") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile6") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile7") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile8") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile9") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile10") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
par(opar)
par <- par()
par(mfrow=c(2,1))
a <- eHH_cap %>% filter(decile=="decile1") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile2") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
par(opar)
opar <- par()
par(mfrow=c(5,1))
a <- eHH_cap %>% filter(decile=="decile1") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile2") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile3") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile4") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile5") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
xlcFreeMemory()
par(opar)
par()
opar <- par()
par(mfrow=c(3,1), oma = c(0, 0, 0, 0), mar= c(0, 0, 0, 0))
a <- eHH_cap %>% filter(decile=="decile1") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile2") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile3") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile4") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile5") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile6") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile7") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile8") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile9") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
a <- eHH_cap %>% filter(decile=="decile10") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
par(opar)
a <- eHH_cap %>% filter(decile=="decile10") %>% select(starts_with("V"))
hist(as.matrix(a),100000)
opar <- par()
par(mfrow=c(5,1), oma = c(0, 0, 0, 0), mar= c(0, 0, 0, 0))
a <- eHH_cap %>% filter(decile=="decile1") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,500000))
a <- eHH_cap %>% filter(decile=="decile2") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,500000))
a <- eHH_cap %>% filter(decile=="decile3") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,500000))
a <- eHH_cap %>% filter(decile=="decile4") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,500000))
a <- eHH_cap %>% filter(decile=="decile5") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,500000))
a <- eHH_cap %>% filter(decile=="decile6") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,500000))
a <- eHH_cap %>% filter(decile=="decile7") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,500000))
a <- eHH_cap %>% filter(decile=="decile8") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,500000))
a <- eHH_cap %>% filter(decile=="decile9") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,500000))
a <- eHH_cap %>% filter(decile=="decile10") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,500000))
par(opar)
opar <- par()
par(mfrow=c(5,1), oma = c(0, 0, 0, 0), mar= c(0, 0, 0, 0))
a <- eHH_cap %>% filter(decile=="decile1") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000),main=NULL)
a <- eHH_cap %>% filter(decile=="decile2") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000),main=NULL)
a <- eHH_cap %>% filter(decile=="decile3") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000),main=NULL)
a <- eHH_cap %>% filter(decile=="decile4") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000),main=NULL)
a <- eHH_cap %>% filter(decile=="decile5") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000),main=NULL)
a <- eHH_cap %>% filter(decile=="decile6") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000),main=NULL)
a <- eHH_cap %>% filter(decile=="decile7") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000),main=NULL)
a <- eHH_cap %>% filter(decile=="decile8") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000),main=NULL)
a <- eHH_cap %>% filter(decile=="decile9") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000),main=NULL)
a <- eHH_cap %>% filter(decile=="decile10") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000),main=NULL)
par(opar)
eHH_cap_avg <- cbind(eHH[,1], apply(eHH[,2:(n_draw+1)], 1, mean) / eHH$hh_size, eHH[,(n_draw+2):dim(eHH)[2]])
xlcFreeMemory()
eHH_cap_avg <- cbind(eHH[,1], apply(eHH[,2:(n_draw+1)], 1, mean) / eHH$hh_size, eHH[,(n_draw+2):dim(eHH)[2]])
View(eHH_cap_avg)
names(eHH_cap_avg)[2] <- "V1"
View(eHH_cap_avg)
PlotIntensityHist <- function (intens_HH) {
opar <- par()
a <- intens_HH %>% filter(decile=="decile1") %>% select(starts_with("V"))
par(mfrow=c(5,1), oma = c(0, 0, 0, 0), mar= c(0, 0, 0, 0))
hist(as.matrix(a),100000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile2") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile3") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile4") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile5") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile6") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile7") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile8") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile9") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile10") %>% select(starts_with("V"))
hist(as.matrix(a),100000, xlim=c(0,300000), main=NULL)
par(opar)
}
PlotIntensityHist(eHH_cap_avg)
PlotIntensityHist <- function (intens_HH) {
opar <- par()
a <- intens_HH %>% filter(decile=="decile1") %>% select(starts_with("V"))
par(mfrow=c(5,1), oma = c(0, 0, 0, 0), mar= c(0, 0, 0, 0))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile2") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile3") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile4") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile5") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile6") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile7") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile8") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile9") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile10") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
par(opar)
}
PlotIntensityHist <- function (intens_HH) {
xlcFreeMemory()
opar <- par()
a <- intens_HH %>% filter(decile=="decile1") %>% select(starts_with("V"))
par(mfrow=c(5,1), oma = c(0, 0, 0, 0), mar= c(0, 0, 0, 0))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile2") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile3") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile4") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile5") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile6") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile7") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile8") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile9") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile10") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
par(opar)
}
PlotIntensityHist(eHH_cap_avg)
?Sd
?sd
apply(eHH[10,2:(n_draw+1)], 1, sd)
apply(eHH[1:10,2:(n_draw+1)], 1, sd)
apply(eHH[1:10,2:(n_draw+1)], 1, sd) / eHH$hh_size[1:10]
apply(eHH[1:20,2:(n_draw+1)], 1, sd) / eHH$hh_size[1:20]
apply(eHH[1:20,2:(n_draw+1)]/ eHH$hh_size[1:20], 1, sd)
View(eHH_cap_avg)
eHH_cap_avg <- cbind(eHH[,1], apply(eHH[,2:(n_draw+1)], 1, mean) / eHH$hh_size,
sd=apply(eHH[,2:(n_draw+1)], 1, sd) / eHH$hh_size, eHH[,(n_draw+2):dim(eHH)[2]])
View(eHH_cap_avg)
?starts_with
?select
num_range("V", 4:6)
PlotIntensityHist <- function (intens_HH, name="V") {
xlcFreeMemory()
opar <- par()
a <- intens_HH %>% filter(decile=="decile1") %>% select(starts_with(name))
par(mfrow=c(5,1), oma = c(0, 0, 0, 0), mar= c(0, 0, 0, 0))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile2") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile3") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile4") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile5") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile6") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile7") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile8") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile9") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
a <- intens_HH %>% filter(decile=="decile10") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
par(opar)
}
PlotIntensityHist(eHH_cap_avg, "sd")
max(eHH_cap_avg$sd)
PlotIntensityHist <- function (intens_HH, name="V", xmax) {
xlcFreeMemory()
opar <- par()
a <- intens_HH %>% filter(decile=="decile1") %>% select(starts_with(name))
par(mfrow=c(5,1), oma = c(0, 0, 0, 0), mar= c(0, 0, 0, 0))
hist(as.matrix(a), 10000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile2") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile3") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile4") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile5") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile6") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile7") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile8") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile9") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile10") %>% select(starts_with(name))
hist(as.matrix(a), 10000, xlim=c(0,xmax), main=NULL)
par(opar)
}
PlotIntensityHist(eHH_cap_avg, "sd", max=10000)
PlotIntensityHist(eHH_cap_avg, "sd", xmax=10000)
?spread
?melt
?gather
stocks <- data_frame(
time = as.Date('2009-01-01') + 0:9,
X = rnorm(10, 0, 1),
Y = rnorm(10, 0, 2),
Z = rnorm(10, 0, 4)
)
stocks %>% gather(stock, price, -time)
stocks
eHH_cap[1:3,1:1001] %>% gather(id, ecap, -id)
eHH_cap <- cbind(id=eHH[,1], eHH[,2:(n_draw+1)] / eHH$hh_size, eHH[,(n_draw+2):dim(eHH)[2]])
xlcFreeMemory()
# eHH_dec <- aggregate(.~decile, eHH, sum)
xlcFreeMemory()
eHH_cap <- cbind(id=eHH[,1], eHH[,2:(n_draw+1)] / eHH$hh_size, eHH[,(n_draw+2):dim(eHH)[2]])
gc()
xlcFreeMemory()
eHH_cap <- cbind(id=eHH[,1], eHH[,2:(n_draw+1)] / eHH$hh_size, eHH[,(n_draw+2):dim(eHH)[2]])
eHH_cap_long <- eHH_cap[1:3,1:1001] %>% gather(id, ecap, -id)
View(eHH_cap_long)
eHH_cap_long <- eHH_cap[1:3,1:1001] %>% gather(draw, ecap, -id)
View(eHH_cap_long)
eHH_cap_long <- eHH_cap[1:3,1:1001] %>% gather(draw, ecap, -id) %>% arrange(id)
View(eHH_cap)
View(eHH_cap_long)
View(eHH_cap)
eHH_cap_long <- eHH_cap[1:3,1:1001] %>% gather(draw, ecap, -id) %>% arrange(id)
View(eHH_cap_long)
eHH_cap_long <- eHH_cap[,1:1001] %>% gather(draw, ecap, -id) %>% arrange(id)
names(eHH)
eHH_cap_long <- eHH_cap[1:3,1:1001] %>% gather(draw, ecap, -c(id, decile)) %>% arrange(id)
eHH_cap_long <- eHH_cap[1:3,] %>% gather(draw, ecap, -c(id, decile)) %>% arrange(id)
View(eHH_cap_long)
]?aov
?aov
aov(ecap~id, eHH_cap_long)
xlcFreeMemory()
gc()
summary(aov(ecap~id, eHH_cap_long))
?ddply
ddply(eHH_cap_long, ~decile, function (x) summary(aov(ecap~id, eHH_cap_long)))
eHH_cap_long <- eHH_cap[1:3,] %>% gather(draw, ecap, -c(id, decile)) %>% arrange(id)
View(eHH_cap_long)
names(eHH)
eHH_cap_long <- eHH_cap[1:3,c(1:1001,1007)] %>% gather(draw, ecap, -c(id, decile)) %>% arrange(id)
ddply(eHH_cap_long, ~decile, function (x) summary(aov(ecap~id, eHH_cap_long)))
View(eHH_cap_long)
ddply(eHH_cap_long, ~decile, function (x) summary(aov(ecap~id, x)))
paste0('decile',i)
for (i in 1:10) {
summary(aov(ecap~id, eHH_cap_long[eHH_cap_long$decile==paste0('decile',i),]))
}
i=1
eHH_cap_long[eHH_cap_long$decile==paste0('decile',i),]
eHH_cap_long <- eHH_cap[,c(1:1001,1007)] %>% gather(draw, ecap, -c(id, decile)) %>% arrange(id)
xlcFreeMemory()
eHH_cap_long <- eHH_cap[,c(1:1001,1007)] %>% gather(draw, ecap, -c(id, decile)) %>% arrange(id)
gc()
rm(alloc_nonRAS)
gc()
xlcFreeMemory()
eHH_cap_long <- eHH_cap[,c(1:1001,1007)] %>% gather(draw, ecap, -c(id, decile)) %>% arrange(id)
memory.size()
?memory.size
rm(final_alloc_list_IND_noVal)
rm(final_alloc_list_FRA_noVal)
rm(result_FRA_noVal)
rm(result_IND_noVal)
gc()
xlcFreeMemory()
eHH_cap_long <- eHH_cap[,c(1:1001,1007)] %>% gather(draw, ecap, -c(id, decile)) %>% arrange(id)
gc()
xlcFreeMemory()
gc()
a <- eHH_cap %>% filter(decile=="decile1") %>% select(starts_with("V"))
hist(as.matrix(a), 10000, xlim=c(0,300000), main=NULL)
hist(as.matrix(a), 1000, xlim=c(0,300000), main=NULL)
PlotIntensityHist <- function (intens_HH, name="V", xmax) {
xlcFreeMemory()
opar <- par()
a <- intens_HH %>% filter(decile=="decile1") %>% select(starts_with(name))
par(mfrow=c(5,1), oma = c(0, 0, 0, 0), mar= c(0, 0, 0, 0))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile2") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile3") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile4") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile5") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile6") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile7") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile8") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile9") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile10") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
par(opar)
}
PlotIntensityHist(eHH_cap, "V", xmax=300000)
PlotIntensityHist(eHH_cap_avg, "V", xmax=300000)
PlotIntensityHist <- function (intens_HH, name="V", xmax) {
xlcFreeMemory()
opar <- par()
a <- intens_HH %>% filter(decile=="decile1") %>% select(starts_with(name))
par(mfrow=c(10,1), oma = c(0, 0, 0, 0), mar= c(0, 0, 0, 0))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile2") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile3") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile4") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile5") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile6") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile7") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile8") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile9") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile10") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
par(opar)
}
PlotIntensityHist <- function (intens_HH, name="V", xmax) {
xlcFreeMemory()
opar <- par()
a <- intens_HH %>% filter(decile=="decile1") %>% select(starts_with(name))
par(mfrow=c(10,1), oma = c(0, 0, 0, 0), mar= c(0, 0, 0, 0))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile2") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile3") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile4") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile5") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile6") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile7") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile8") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile9") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
a <- intens_HH %>% filter(decile=="decile10") %>% select(starts_with(name))
hist(as.matrix(a), 1000, xlim=c(0,xmax), main=NULL)
par(opar)
}
PlotIntensityHist(eHH_cap, "V", xmax=300000)
par(opar)
}
warnings()
PlotIntensityHist(eHH_cap_avg, "V", xmax=300000)
eHH_cap_avg <- cbind(eHH[,1], apply(eHH[,2:(n_draw+1)], 1, mean) / eHH$hh_size,
sd=apply(eHH[,2:(n_draw+1)], 1, sd) / eHH$hh_size, eHH[,(n_draw+2):dim(eHH)[2]])
save.image()
